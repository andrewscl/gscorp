<div th:fragment="content">

  <div class="site-visit-header"
       th:with="fromVar=${from != null ? from : (fromDate != null ? fromDate : null)},
                toVar=${to != null ? to : (toDate != null ? toDate : null)}">

    <!-- fila de título: icono + texto a la izquierda, badge de cantidad a la derecha -->
    <div class="title-row" role="heading" aria-level="2">
      <div class="title-left" aria-hidden="true">
        <!-- Icono tabla -->
        <svg class="icon icon-table" width="24" height="24" viewBox="0 0 24 24" focusable="false">
          <rect x="2" y="4" width="20" height="16" rx="2" fill="#eef2ff" stroke="#2563eb" stroke-width="1"/>
          <path d="M6 12h12M6 8h12M6 16h8" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span class="title-text">Supervisión de Instalaciones</span>
      </div>

      <!-- badge con cantidad de registros (alineado a la derecha) -->
      <span class="visits-count" th:if="${visitsCount != null}"
            th:text="${visitsCount + ' registro' + (visitsCount == 1 ? '' : 's')}"
            aria-live="polite" aria-atomic="true"></span>
    </div>

    <!-- línea descriptiva / resumen: debajo del título -->
    <div class="header-meta" th:if="${fromVar != null or toVar != null or visitsCount != null}">
      <p class="header-meta__dates" th:if="${fromVar != null and toVar != null}"
         th:text="'Mostrando desde ' + ${#temporals.format(fromVar, 'dd/MM/yyyy')} + ' hasta ' + ${#temporals.format(toVar, 'dd/MM/yyyy')}">
        Mostrando desde ... hasta ...
      </p>

      <p class="header-meta__dates" th:if="${fromVar != null and toVar == null}"
         th:text="'Mostrando desde ' + ${#temporals.format(fromVar, 'dd/MM/yyyy')}">
        Mostrando desde ...
      </p>

      <p class="header-meta__dates" th:if="${fromVar == null and toVar != null}"
         th:text="'Mostrando hasta ' + ${#temporals.format(toVar, 'dd/MM/yyyy')}">
        Mostrando hasta ...
      </p>

      <p class="header-meta__summary" th:if="${fromVar == null and toVar == null and visitsCount != null}"
         th:text="'Resultados encontrados: ' + ${visitsCount}">
        Resultados encontrados: 0
      </p>
    </div>

    <!-- toolbar / filtros (igual que antes) -->
    <div class="filters-row" role="toolbar" aria-label="Filtros de supervisión">
      <label class="filter-item">
        <span class="filter-label">Desde</span>
        <input id="filter-from" class="filter-input" type="date" name="from"
               th:value="${from != null ? #temporals.format(from, 'yyyy-MM-dd') : (fromDate != null ? #temporals.format(fromDate, 'yyyy-MM-dd') : '')}" />
      </label>

      <label class="filter-item">
        <span class="filter-label">Hasta</span>
        <input id="filter-to" class="filter-input" type="date" name="to"
               th:value="${to != null ? #temporals.format(to, 'yyyy-MM-dd') : (toDate != null ? #temporals.format(toDate, 'yyyy-MM-dd') : '')}" />
      </label>

      <button id="applyFiltersBtn" class="btn btn-secondary"
              th:attr="data-path=@{/private/site-supervision-visits/table-search}" aria-label="Aplicar filtros">
        Aplicar
      </button>

      <div class="filters-actions">
        <button id="createSupervisionVisitBtn" class="btn btn-primary"
                th:attr="data-path=@{/private/site-supervision-visits/create}" aria-label="Registrar visita">
          <!-- icono + -->
          <svg class="icon icon-plus" width="16" height="16" viewBox="0 0 16 16" focusable="false">
            <circle cx="8" cy="8" r="7" fill="#dbeafe" stroke="#1e3a8a" stroke-width="1"/>
            <path d="M8 5v6M5 8h6" stroke="#1e3a8a" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Registrar Visita
        </button>
      </div>
    </div>

  </div>

  <div class="site-visit-table-container">
    <table class="site-visit-table" role="table" aria-label="Tabla de visitas de supervisión">
      <caption class="visually-hidden">Listado de visitas de supervisión</caption>
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Supervisor</th>
          <th scope="col">Instalación</th>
          <th scope="col">Fecha y Hora</th>
          <th scope="col">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="v : ${visits}" th:attr="data-id=${v.id}">
          <td th:text="${v.id}">—</td>

          <td th:text="${v.employeeName != null ? v.employeeName : '—'}">—</td>
          <td th:text="${v.siteName != null ? v.siteName : '—'}">—</td>

          <td th:text="${v.visitDateTimeFormatted != null ? v.visitDateTimeFormatted : '—'}">—</td>

          <td class="actions">
            <button type="button" class="btn-link action-btn" title="Ver"
                    th:attr="data-path=@{/private/site-supervision-visits/show/{id}(id=${v.id})}">
              <span aria-hidden="true">Ver</span>
              <span class="visually-hidden" th:text="${'Ver visita ' + v.id}">Ver visita</span>
            </button>

            <button type="button" class="btn-link action-btn"
                    th:if="${#authorization.expression('hasRole(''ADMINISTRATOR'')')}"
                    th:attr="data-path=@{/private/site-supervision-visits/edit/{id}(id=${v.id})}" title="Editar">
              Editar
            </button>
          </td>
        </tr>

        <tr th:if="${#lists.isEmpty(visits)}">
          <td colspan="7" class="empty">No se encontraron registros para el rango seleccionado.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script type="module" src="/js/private/site-visits/site-visit-table.js"></script>

</div>