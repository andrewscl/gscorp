<!-- Botón de asistencia + mapa de ubicación -->
<section th:fragment="attendanceButton" class="card attendance" style="max-width:520px;padding:1rem">
  <h3 style="margin-top:0">Asistencia</h3>

  <!-- Aquí el JS mostrará el nombre del sitio cuando lo detecte -->
  <div id="att-status" style="margin:.5rem 0;color:#444">Detectando sitio más cercano...</div>

  <div id="att-widget"
       data-punch-endpoint="/api/attendance/punch"
       style="display:flex;gap:.5rem;flex-wrap:wrap">

    <!-- Los botones se mostrarán/ocultarán por JS según estado -->
    <button id="att-in"  class="btn btn-primary"   type="button" style="display:none">Marcar entrada</button>
    <button id="att-out" class="btn btn-secondary" type="button" style="display:none">Marcar salida</button>
  </div>

  <small style="display:block;margin-top:.5rem;color:#666">
    Se solicitará tu ubicación (GPS) para validar la marcación.<br>
    <span style="color:#888;font-size:0.9em">El mapa muestra tu ubicación actual, solo de referencia.</span>
  </small>

  <pre th:text="${#objects.toJson(sites)}"></pre>

  <!-- Mapa de ubicación actual -->
  <div id="att-map-container" style="width:100%;height:220px;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px -4px #cbd5e1;margin-bottom:1rem;background:#f3f4f6">
    <div id="att-map" style="width:100%;height:100%"></div>
  </div>

    <!-- Serializa la lista de sitios antes de cargar attendance.js 
    <script th:inline="javascript">
      /*<![CDATA[*/
      window.attendanceSites = /*[[${#objects.toJson(sites)}]]*/;
      /*]]>*/
    </script>-->

  <script type="module" th:src="@{/js/private/attendance/attendance.js}" defer></script>
</section>