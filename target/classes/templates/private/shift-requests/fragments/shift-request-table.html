<div th:fragment="content" id="shift-requests-root" class="shift-requests-root">

  <div class="shift-requests-header"
       th:with="fromVar=${from != null ? from : (fromDate != null ? fromDate : null)},
                toVar=${to != null ? to : (toDate != null ? toDate : null)}">

    <!-- title row: icon + text left, badge (count) right -->
    <div class="title-row" role="heading" aria-level="2">
      <div class="title-left" aria-hidden="true">
        <!-- icon table-like -->
        <svg class="icon icon-table" width="24" height="24" viewBox="0 0 24 24" focusable="false" style="vertical-align: -3px;">
          <rect x="2" y="4" width="20" height="16" rx="2" fill="#eef2ff" stroke="#2563eb" stroke-width="1"/>
          <path d="M6 12h12M6 8h12M6 16h8" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span class="title-text">Requerimientos de turno</span>
      </div>

      <!-- badge with count -->
      <span class="requests-count" th:if="${shiftRequestsCount != null}"
            th:text="${shiftRequestsCount + ' registro' + (shiftRequestsCount == 1 ? '' : 's')}"
            aria-live="polite" aria-atomic="true"></span>
    </div>

    <!-- header meta -->
    <div class="header-meta"
         th:replace="private/shift-requests/fragments/shift-request-header-meta :: headerMeta(${fromVar}, ${toVar}, ${shiftRequestsCount})">
    </div>

    <!-- filters / toolbar -->
    <div class="filters-row" role="toolbar" aria-label="Filtros de requerimientos de turno">
      <label class="filter-item">
        <span class="filter-label">Desde</span>
        <input id="filter-from" class="filter-input" type="date" name="from"
               th:value="${from != null ? #temporals.format(from, 'yyyy-MM-dd') : (fromDate != null ? #temporals.format(fromDate, 'yyyy-MM-dd') : '')}" />
      </label>

      <label class="filter-item">
        <span class="filter-label">Hasta</span>
        <input id="filter-to" class="filter-input" type="date" name="to"
               th:value="${to != null ? #temporals.format(to, 'yyyy-MM-dd') : (toDate != null ? #temporals.format(toDate, 'yyyy-MM-dd') : '')}" />
      </label>

      <label class="filter-item">
          <span class="filter-label">Tipo de requerimiento</span>
          <select id="filter-type" class="filter-input" name="type">
            <option value="" th:text="'Todas'"></option>
            <option th:each="m : ${shiftRequestTypes}"
                    th:value="${m.name()}"
                    th:text="${m.displayName != null ? m.displayName : m.name()}"
                    th:selected="${m == type}"></option>
          </select>
      </label>

      <button id="applyShiftFiltersBtn" type="button" class="btn btn-secondary"
              data-ajax-url="/private/shift-requests/table-search"
              aria-label="Aplicar filtros">
        Aplicar
      </button>

      <div class="filters-actions">
        <button id="createShiftRequestBtn" class="btn btn-primary"
                th:if="${#authorization.expression('hasRole(''SCHEDULER'')')}"
                th:attr="data-path=@{/private/shift-requests/create}" aria-label="Crear requerimiento">
          <svg class="icon icon-plus" width="16" height="16" viewBox="0 0 16 16" focusable="false">
            <circle cx="8" cy="8" r="7" fill="#dbeafe" stroke="#1e3a8a" stroke-width="1"/>
            <path d="M8 5v6M5 8h6" stroke="#1e3a8a" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Crear Requerimiento
        </button>
      </div>
    </div>

  </div>

  <div class="shift-requests-table-container">
    <table class="shift-requests-table" role="table" aria-label="Tabla de requerimientos de turno">
      <caption class="visually-hidden">Listado de requerimientos de turno</caption>
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">CÃ³digo</th>
          <th scope="col">Sitio</th>
          <th scope="col">Tipo</th>
          <th scope="col">Fecha inicio</th>
          <th scope="col">Fecha fin</th>
          <th scope="col">Acciones</th>
        </tr>
      </thead>

      <!-- Render rows via a fragment for consistency -->
      <tbody th:replace="private/shift-requests/fragments/shift-request-table-rows :: rows"></tbody>
    </table>
  </div>

  <!-- Module scripts for interactive behavior (search, row actions, SPA navigation) -->
  <script type="module" src="/js/private/shift-requests/shift-request-table.js"></script>
  <script type="module" src="/js/private/shift-requests/shift-request-table-update.js"></script>
</div>