<section th:fragment="content" class="editUser">

  <div class="editUserCard">

    <div class="editUserHeader">
      <h3>Editar usuario</h3>
    </div>

    <!-- Información básica y formulario -->
    <form id="editUserForm" class="editUser-body"
          th:attr="data-user-endpoint=@{/api/users/update/{id}(id=${user.id})}" method="post">

      <!-- Información básica del usuario -->
      <div class="form-group">
        <label for="userId">ID</label>
        <input type="text" id="userId" name="id" th:value="${user.id}" readonly />
      </div>

      <div class="form-group">
        <label for="userUsername">Username</label>
        <input type="text" id="userUsername" name="username" th:value="${user.username}" required />
      </div>

      <div class="form-group">
        <label for="userMail">Correo Electrónico</label>
        <input type="email" id="userMail" name="mail" th:value="${user.mail}" required />
      </div>

      <div class="form-group">
        <label for="userActive">Activo</label>
        <input type="checkbox" id="userActive" name="active" th:checked="${user.active}" />
      </div>

      <!-- Roles -->
      <div class="form-group">
        <label for="userRoles">Roles</label>
        <select id="userRoles" name="roleIds" multiple size="6">
          <!-- Itera sobre "roles" disponibles -->
          <option th:each="role : ${roles}" 
                  th:value="${role.id}" 
                  th:text="${role.role}" 
                  th:selected="${user.roles != null and user.roles.contains(role)}">
          </option>
        </select>
      </div>

      <!-- Clientes -->
      <div class="form-group">
        <label for="userClients">Clientes</label>
        <select id="userClients" name="clientIds" multiple size="6">
          <option th:each="client : ${clients}"
                  th:value="${client.id}"
                  th:text="${client.name}"
                  th:selected="${user.clients != null and user.clients.contains(client)}">
          </option>
        </select>
      </div>

      <!-- Empleado único asociado -->
      <div class="form-group">
        <label for="userEmployeeId">Empleado Asociado</label>
        <select id="userEmployeeId" name="employeeId">
          <option value="">-- ninguno --</option>
          <option th:each="employee : ${employees}"
                  th:value="${employee.id}"
                  th:text="${employee.fullName != null ? employee.fullName : 'Empleado ' + employee.id}"
                  th:selected="${user.employee != null and user.employee.id == employee.id}">
          </option>
        </select>
      </div>

      <!-- Zona horaria -->
      <div class="form-group">
        <label for="userTimeZone">Zona horaria (IANA)</label>
        <input type="text" id="userTimeZone" name="timeZone"
               th:value="${user.timeZone}" placeholder="Europe/Madrid" />
        <button type="button" id="detectUserTimeZone" class="vs-btn vs-secondary">Detectar zona</button>
      </div>

      <!-- Botones de control -->
      <div class="modal-footer">
        <button type="submit" id="saveUserBtn" data-id="${user.id}" class="btn-primary">Guardar cambios</button>
        <button type="button" id="cancelEditUserBtn" class="btn-secondary"
                th:attr="data-path=@{/private/users/table-view}">Cancelar</button>
        <button type="button" id="deleteUserBtn" class="btn-danger"
                th:attr="data-id=${user.id}">Eliminar usuario</button>
      </div>

      <!-- Mensajes del formulario -->
      <div class="form-error" id="editUserError"></div>
      <div class="form-ok" id="editUserOk" style="display: none;">Usuario actualizado ✅</div>

    </form>

  </div>

  <script type="module" src="/js/private/admin/users/edit-user.js"></script>

</section>