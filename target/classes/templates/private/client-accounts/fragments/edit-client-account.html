<section th:fragment="content" class="detail-section edit-client-account">

  <h2>Editar Cuenta de Cliente</h2>
  <p class="meta-id"><strong>ID:</strong> <span th:text="${clientAccount.id}">1</span></p>

  <form id="editClientAccountForm" class="card form" novalidate>
    <!-- Nombre -->
    <div class="form-group">
      <label for="clientAccountName">Nombre <span class="required">*</span></label>
      <input id="clientAccountName" name="name" type="text" maxlength="160" required
             th:value="${clientAccount.name != null ? clientAccount.name : ''}" />
      <small>Nombre interno de la cuenta (máx. 160 caracteres).</small>
    </div>

    <!-- Cliente (select cuando hay >1, hidden cuando viene preseleccionado) -->
    <div class="form-group">
      <label for="clientAccountClient">Cliente <span class="required">*</span></label>

      <!-- Si en el modelo hay preselectedClientId, añadimos hidden y mostramos el nombre (read-only) -->
      <div th:if="${preselectedClientId != null}">
        <input type="hidden" name="clientId" th:value="${preselectedClientId}" />
        <span class="readonly-field" th:text="${preselectedClientName != null ? preselectedClientName : 'Cliente preseleccionado'}"></span>
        <small>El cliente está preseleccionado por tu cuenta.</small>
      </div>

      <!-- Si hay lista de clients, renderizar select (editable) -->
      <div th:if="${clients != null and #lists.size(clients) > 0 and preselectedClientId == null}">
        <select id="clientAccountClient" name="clientId" required>
          <option value="">-- Seleccionar cliente --</option>
          <option th:each="c : ${clients}"
                  th:value="${c.id}"
                  th:text="${c.name}"
                  th:selected="${clientAccount.clientId != null ? (c.id == clientAccount.clientId) : false}">
          </option>
        </select>
        <small>Selecciona el cliente al que pertenece esta cuenta.</small>
      </div>

      <!-- Fallback si no hay clientes disponibles -->
      <div th:if="${(clients == null or #lists.isEmpty(clients)) and preselectedClientId == null}">
        <span class="readonly-field">—</span>
        <small>No hay clientes disponibles para asignar.</small>
      </div>
    </div>

    <!-- Notas -->
    <div class="form-group">
      <label for="clientAccountNotes">Notas</label>
      <textarea id="clientAccountNotes" name="notes" maxlength="400"
                th:text="${clientAccount.notes != null ? clientAccount.notes : ''}"></textarea>
      <small>Notas internas (máx. 400 caracteres).</small>
    </div>

    <!-- Mensaje de estado -->
    <div id="editClientAccountMessage" class="form-message"></div>

    <!-- Acciones -->
    <div class="actions">
      <button type="submit" class="vs-btn vs-primary" id="saveClientAccountBtn">Guardar</button>
      <button type="button" class="vs-btn vs-secondary" id="cancelEditClientAccountBtn"
              data-path="/private/client-accounts/table-view">Cancelar</button>
    </div>

    <div id="editClientAccountError" class="form-error"></div>
    <div id="editClientAccountOk" class="form-ok" style="display:none;">Guardado ✅</div>
  </form>

  <style>
    .detail-section.edit-client-account { max-width:980px; margin:0 auto; }
    .form-group { margin-bottom:1rem; display:block; }
    label { display:block; margin-bottom:.35rem; font-weight:600; color:#0f172a; }
    .required { color:#ef4444; margin-left:.15rem; font-weight:700; }
    input[type="text"], select, textarea {
      width:100%;
      padding:.5rem;
      border:1px solid #e6e6e6;
      border-radius:6px;
      background:#fff;
      color:#0f172a;
      font-size:1rem;
      box-sizing:border-box;
    }
    select { appearance: none; -webkit-appearance: none; -moz-appearance: none; }
    textarea { min-height:120px; resize:vertical; }
    .readonly-field { display:inline-block; padding:.25rem .5rem; background:#fafafa; border:1px solid #eee; border-radius:4px; color:#111827; }
    .meta-id { margin-bottom:.8rem; color:#475569; }
    .actions { margin-top:1rem; display:flex; gap:.5rem; align-items:center; }
    .vs-btn { padding:.45rem .75rem; border-radius:6px; border:1px solid transparent; cursor:pointer; font-weight:600; }
    .vs-primary { background:#06b6d4; color:#fff; border-color:#06b6d4; }
    .vs-secondary { background:transparent; color:#0f172a; border-color:#e5e7eb; border:1px solid #e5e7eb; }
    .form-error { color:#ef4444; margin-top:.6rem; }
    .form-ok { color:#10b981; margin-top:.6rem; }

    @media (max-width:640px) {
      .actions { flex-direction:column; align-items:stretch; }
      .vs-btn { width:100%; text-align:center; }
    }
  </style>

  <script type="module" src="/js/private/client-accounts/edit-client-account.js"></script>
</section>