import{f as p,i as h}from"../chunks/api-Bh71dfFu.js";async function y(n,a,s){const e=n.querySelector("#chart-att");if(!e){console.warn("[attendance chart] #chart-att no existe");return}let o=[];try{const t=await p(`/api/attendance/series?from=${a}&to=${s}&action=IN`);t.ok?o=await t.json():console.warn("[attendance chart] API status:",t.status,await t.text().catch(()=>""))}catch(t){console.warn("[attendance chart] fetch error",t)}const u=o.map(t=>t.x),i=o.map(t=>t.y),c=i.some(t=>Number(t)>0),r=h(e,void 0,{renderer:"canvas"});r.setOption({tooltip:{trigger:"axis"},legend:{show:!0},grid:{left:40,right:16,top:24,bottom:32},xAxis:{type:"category",boundaryGap:!1,data:u},yAxis:{type:"value"},series:[{name:"Entradas",type:"line",smooth:!0,areaStyle:{},data:i,color:"#2563eb"}],graphic:c?{elements:[]}:{elements:[{type:"text",left:"center",top:"middle",style:{text:"Sin datos",fill:"#9ca3af",fontSize:14}}]}});const l=new ResizeObserver(()=>r.resize());l.observe(e);const d=()=>{document.removeEventListener("fragment:will-unload",d);try{l.disconnect()}catch{}try{r.dispose()}catch{}};document.addEventListener("fragment:will-unload",d,{once:!0})}async function v(n,a,s){const e=n.querySelector("#chart-inc");if(!e){console.warn("[incidents chart] #chart-inc no existe");return}let o=[];try{const t=await p(`/api/incidents/series?from=${a}&to=${s}`);t.ok?o=await t.json():console.warn("[incidents chart] API status:",t.status,await t.text().catch(()=>""))}catch(t){console.warn("[incidents chart] fetch error",t)}const u=o.map(t=>t.x),i=o.map(t=>t.y),c=i.some(t=>Number(t)>0),r=h(e,void 0,{renderer:"canvas"});r.setOption({tooltip:{trigger:"axis"},legend:{show:!0},grid:{left:40,right:16,top:24,bottom:32},xAxis:{type:"category",boundaryGap:!1,data:u},yAxis:{type:"value"},series:[{name:"Incidentes",type:"bar",data:i,color:"#f43f5e"}],graphic:c?{elements:[]}:{elements:[{type:"text",left:"center",top:"middle",style:{text:"Sin datos",fill:"#9ca3af",fontSize:14}}]}});const l=new ResizeObserver(()=>r.resize());l.observe(e);const d=()=>{document.removeEventListener("fragment:will-unload",d);try{l.disconnect()}catch{}try{r.dispose()}catch{}};document.addEventListener("fragment:will-unload",d,{once:!0})}async function w(n,a,s){const e=n.querySelector("#chart-visit");if(!e){console.warn("[visits chart] #chart-visit no existe");return}let o=[];try{const t=await p(`/api/site-supervision-visits/series?from=${a}&to=${s}`);t.ok?o=await t.json():console.warn("[visits chart] API status:",t.status,await t.text().catch(()=>""))}catch(t){console.warn("[visits chart] fetch error",t)}const u=o.map(t=>t.x),i=o.map(t=>t.y),c=i.some(t=>Number(t)>0),r=h(e,void 0,{renderer:"canvas"});r.setOption({tooltip:{trigger:"axis"},legend:{show:!0},grid:{left:40,right:16,top:24,bottom:32},xAxis:{type:"category",boundaryGap:!1,data:u},yAxis:{type:"value"},series:[{name:"Visitas",type:"line",smooth:!0,areaStyle:{},data:i,color:"#0ea5e9"}],graphic:c?{elements:[]}:{elements:[{type:"text",left:"center",top:"middle",style:{text:"Sin datos",fill:"#9ca3af",fontSize:14}}]}});const l=new ResizeObserver(()=>r.resize());l.observe(e);const d=()=>{document.removeEventListener("fragment:will-unload",d);try{l.disconnect()}catch{}try{r.dispose()}catch{}};document.addEventListener("fragment:will-unload",d,{once:!0})}async function f(n,a,s){const e={att:`/api/attendance/kpi?from=${a}&to=${s}`,patrol:`/api/patrols/kpi?from=${a}&to=${s}`,visit:`/api/site-supervision-visits/kpi?from=${a}&to=${s}`,inc:`/api/incidents/kpi?from=${a}&to=${s}`};await Promise.all(Object.entries(e).map(async([o,u])=>{const i=n.querySelector(`[data-kpi="${o}"]`);if(i)try{const c=await p(u);if(!c.ok)throw new Error;const r=await c.text();i.textContent=r||"0"}catch{i.textContent="â€“"}}))}function g(n=new Date){return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`}function x(n){const[a,s]=n.split("-").map(Number),e=new Date(a,s,0);return`${n}-${String(e.getDate()).padStart(2,"0")}`}async function b({container:n}){const a=n.querySelector("#client-dashboard-root")||n;if(a.dataset.echartsInit==="1")return;a.dataset.echartsInit="1";const s=g(),e=`${s}-01`,o=x(s);typeof f=="function"&&await f(a,e,o),await Promise.all([y(a,e,o),v(a,e,o),w(a,e,o)])}function m(){const n=document.getElementById("client-dashboard-root")||document.body;b({container:n})}document.addEventListener("content:loaded",m);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m();
