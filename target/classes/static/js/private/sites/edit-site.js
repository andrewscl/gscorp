import{f as d}from"../../auth.js";import{n as b}from"../../navigation-handler.js";const c=document.querySelector("#deleteSiteBtn");c&&c.addEventListener("click",async()=>{const e=c.getAttribute("data-id");if(!(!e||!window.confirm("¿Eliminar este sitio? Esta acción no se puede deshacer."))){c.disabled=!0;try{const t=await d(`/api/sites/${e}`,{method:"DELETE"});if(!t.ok){const i=await t.text().catch(()=>"");throw new Error(i||`No se pudo eliminar (HTTP ${t.status})`)}b("/private/sites/table-view",!0)}catch(t){alert(t.message||"Error al eliminar el sitio."),c.disabled=!1}}});const r=document.getElementById("editSiteForm");r&&r.addEventListener("submit",async e=>{e.preventDefault();const n=r.querySelector('button[type="submit"]')?.getAttribute("data-id");if(!n)return;const t=new FormData(r),i={};t.forEach((o,s)=>{s==="active"?i[s]=r.querySelector("#siteActive").checked:i[s]=o});const l=document.getElementById("editSiteError"),u=document.getElementById("editSiteOk");l.textContent="",u.style.display="none";try{const o=await d(`/api/sites/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!o.ok){const s=await o.text().catch(()=>"");throw new Error(s||`No se pudo guardar (HTTP ${o.status})`)}u.style.display="",b("/private/sites/table-view",!0)}catch(o){l.textContent=o.message||"Error al guardar el sitio."}});const a=document.getElementById("getLocationBtn"),m=document.getElementById("siteLat"),g=document.getElementById("siteLon");a&&m&&g&&a.addEventListener("click",async()=>{if(!navigator.geolocation){alert("Geolocalización no soportada por tu navegador.");return}a.disabled=!0,a.textContent="Obteniendo ubicación...",navigator.geolocation.getCurrentPosition(async e=>{m.value=e.coords.latitude,g.value=e.coords.longitude,a.textContent="Ubicación obtenida ✅",setTimeout(()=>{a.textContent="Obtener ubicación actual",a.disabled=!1},1500),alert(`Precisión estimada: ${Math.round(e.coords.accuracy)} metros`);const n=r?.querySelector('button[type="submit"]')?.getAttribute("data-id");if(!n){alert("No se pudo determinar el ID del sitio para guardar la ubicación.");return}try{const t=await d(`/api/sites/update-location/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:e.coords.latitude,lon:e.coords.longitude})});if(!t.ok){const i=await t.text().catch(()=>"");throw new Error(i||`No se pudo guardar la ubicación (HTTP ${t.status})`)}}catch(t){alert(t.message||"Error al guardar la ubicación en el sitio.")}},e=>{alert("No se pudo obtener la ubicación: "+e.message),a.textContent="Obtener ubicación actual",a.disabled=!1},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});
