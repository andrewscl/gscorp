import{f as l}from"../../auth.js";const c=(()=>{let a=!1,o=null;return n=>(a||(o=new Promise((t,s)=>{const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${n}&v=weekly`,e.async=!0,e.defer=!0,e.onload=()=>{console.log("[Google Maps API] Script cargado correctamente."),a=!0,t()},e.onerror=i=>{console.error("[Google Maps API] Error al cargar el script:",i),s(new Error("Error al cargar Google Maps API"))},document.head.appendChild(e)})),o)})(),p=async()=>{const a=document.getElementById("site-map");if(!a){console.warn("[initMap] Contenedor #site-map no encontrado en el DOM.");return}try{const{Map:o}=await google.maps.importLibrary("maps"),n=new o(a,{center:{lat:-33.4489,lng:-70.6693},zoom:12,mapId:googleMapsConfig.mapId,disableDefaultUI:!0});console.log("[initMap] Mapa inicializado."),window.mapInstance=n,await d()}catch(o){console.error("[initMap] Error al inicializar el mapa:",o)}};async function d(){try{const a=await l("/api/sites/projections-by-user",{method:"GET",headers:{Accept:"application/json"}});if(!a.ok){console.log("Error al cargar sitios. Intente nuevamente.");return}const o=await a.json();if(!Array.isArray(o)||!o.every(n=>n.id&&n.lat&&n.lon)){console.log("Datos de sitios inválidos.");return}m(o)}catch(a){console.error("Fallo al obtener sitios:",a),console.log("Error al cargar sitios. Intente nuevamente.")}}async function m(a){const{AdvancedMarkerElement:o,PinElement:n}=await google.maps.importLibrary("marker");a.forEach(t=>{const s=new google.maps.LatLngBounds,e=document.createElement("div");e.style.backgroundColor="#fff",e.style.border="1px solid grey",e.style.padding="4px 8px",e.style.borderRadius="8px",e.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",e.style.position="absolute",e.style.top="-40px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.whiteSpace="nowrap",e.style.display="none",e.textContent=`Sitio: ${t.name||"Sin Nombre"}`;const i=new n({scale:.8,glyphColor:"#3176e3",background:"#359dd1",borderColor:"#1d4d9b"}),r=document.createElement("div");r.style.position="relative",r.appendChild(i.element),r.appendChild(e),new o({map:window.mapInstance,position:{lat:t.lat,lng:t.lon},content:r}),r.addEventListener("mouseenter",()=>{e.style.display="block"}),r.addEventListener("mouseleave",()=>{e.style.display="none"}),s.extend(new google.maps.LatLng(t.lat,t.lon)),console.log(`[addSitesToMapAndSelect] Marcador añadido para sitio: ${t.id}`)}),window.mapInstance.fitBounds(bounds)}(async function(){console.log("[init] IIFE iniciado");const o=googleMapsConfig.apiKey;try{await c(o),p()}catch(n){console.error("[site-map.js] Error al cargar la API de Google Maps:",n)}})();
