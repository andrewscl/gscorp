import{f as p}from"../../auth.js";import{n as j}from"../../navigation-handler.js";const t=e=>document.querySelector(e);function b(){const e=t("#createProjectModal");e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>t("#projectName")?.focus(),0))}function d(){const e=t("#createProjectModal");if(!e)return;e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),t("#createProjectForm")?.reset();const o=t("#createProjectError"),n=t("#createProjectOk");o&&(o.textContent=""),n&&(n.style.display="none")}async function h(){const e=t("#projectClient");if(!(!e||e.querySelectorAll("option").length>1))try{const n=await p("/api/clients/all");if(!n.ok)return;const i=await n.json();e.innerHTML='<option value="" disabled selected>Seleccione cliente</option>',i.forEach(r=>{const c=document.createElement("option");c.value=String(r.id),c.textContent=r.name,e.appendChild(c)})}catch{}}async function v(){b(),await h()}async function C(e){e.preventDefault();const o=t("#createProjectError"),n=t("#createProjectOk");o&&(o.textContent=""),n&&(n.style.display="none");const i=Number(t("#projectClient")?.value),r=t("#projectName")?.value?.trim(),c=t("#projectCode")?.value?.trim()||null,m="",u=t("#projectStartDate")?.value,f=t("#projectEndDate")?.value||null,y=!!t("#projectActive")?.checked;if(!i){o&&(o.textContent="Debes seleccionar un cliente.");return}if(!r){o&&(o.textContent="El nombre es obligatorio.");return}if(!u){o&&(o.textContent="La fecha de inicio es obligatoria.");return}const s=e.submitter||t('#createProjectForm button[type="submit"]');s&&(s.disabled=!0);try{const a=await p("/api/projects/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:i,name:r,code:c,description:m,startDate:u,endDate:f,active:y})});if(!a.ok){let l="";try{l=await a.text()}catch{}throw l||(l=`Error ${a.status}`),new Error(l)}n&&(n.style.display="block"),setTimeout(()=>{d(),j("/private/projects/table-view")},600)}catch(a){o&&(o.textContent=a.message||"No se pudo crear el proyecto")}finally{s&&(s.disabled=!1)}}function k(){t("#createProjectBtn")?.addEventListener("click",v),t("#closeCreateProject")?.addEventListener("click",d),t("#cancelCreateProject")?.addEventListener("click",d),t("#createProjectForm")?.addEventListener("submit",C),document.addEventListener("keydown",e=>{e.key==="Escape"&&d()})}(function(){k()})();
