import{f}from"../../auth.js";import{n as C}from"../../navigation-handler.js";console.log("create-client.js cargado");const e=t=>document.querySelector(t);function v(){const t=e("#createClientModal");t&&(t.classList.remove("hidden"),t.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>e("#clientName")?.focus(),0))}function l(){const t=e("#createClientModal");if(!t)return;t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),e("#createClientForm")?.reset();const i=e("#createClientError"),o=e("#createClientOk");i&&(i.textContent=""),o&&(o.style.display="none")}async function y(t){t.preventDefault();const i=e("#clientName")?.value?.trim(),o=e("#clientLegalName")?.value?.trim()||null,r=e("#clientTaxId")?.value?.trim()||null,s=e("#clientEmail")?.value?.trim()||null,d=e("#clientPhone")?.value?.trim()||null,m=!!e("#clientActive")?.checked,n=e("#createClientError"),c=e("#createClientOk");if(n&&(n.textContent=""),c&&(c.style.display="none"),!i){n&&(n.textContent="El nombre es obligatorio.");return}try{const a=await f("/api/clients/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,legalName:o,taxId:r,contactEmail:s,contactPhone:d,active:m})});if(!a.ok){const u=await a.text().catch(()=>"");throw new Error(u||"No se pudo crear el cliente")}c&&(c.style.display="block"),setTimeout(()=>{l(),C("/private/admin/clients")},600)}catch(a){n&&(n.textContent=a.message)}}function h(){e("#createClientBtn")?.addEventListener("click",v),e("#closeCreateClient")?.addEventListener("click",l),e("#cancelCreateClient")?.addEventListener("click",l),e("#createClientForm")?.addEventListener("submit",y),document.addEventListener("keydown",t=>{t.key==="Escape"&&l()})}(function(){h()})();
