import{f as W}from"../../auth.js";import{n as G}from"../../navigation-handler.js";console.log("create-employee.js cargado");const e=n=>document.querySelector(n);function R(){const n=e("#createEmployeeModal");n&&(n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>e("#employeeName")?.focus(),0))}function s(){const n=e("#createEmployeeModal");if(!n)return;n.classList.add("hidden"),n.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),e("#createEmployeeForm")?.reset();const a=e("#createEmployeeError"),l=e("#createEmployeeOk");a&&(a.textContent=""),l&&(l.style.display="none")}async function U(n){n.preventDefault();const a=e("#employeeName")?.value?.trim(),l=e("#employeeFatherSurname")?.value?.trim()||null,h=e("#employeeMotherSurname")?.value?.trim()||null,v=e("#employeeRut")?.value?.trim()||null,f=e("#employeeMail")?.value?.trim()||null,S=e("#employeePhone")?.value?.trim()||null,b=e("#employeeSecondaryPhone")?.value?.trim()||null,k=e("#employeeGender")?.value?.trim()||null,E=e("#employeeNationality")?.value?.trim()||null,D=e("#employeeMaritalStatus")?.value?.trim()||null,A=e("#employeeStudyLevel")?.value?.trim()||null,L=e("#employeeProfession")?.value?.trim()||null,M=e("#employeePrevitionalSystem")?.value?.trim()||null,P=e("#employeeHealthSystem")?.value?.trim()||null,N=e("#employeePaymentMethod")?.value?.trim()||null,T=e("#employeeBankName")?.value?.trim()||null,g=e("#employeeBankAccountType")?.value?.trim()||null,w=e("#employeeBankAccountNumber")?.value?.trim()||null,x=e("#employeeContractType")?.value?.trim()||null,C=e("#employeeWorkSchedule")?.value?.trim()||null,B=e("#employeeShiftSystem")?.value?.trim()||null,j=e("#employeePosition")?.value?.trim()||null,I=e("#employeeAddress")?.value?.trim()||null,F=e("#employeeHireDate")?.value||null,O=e("#employeeBirthDate")?.value||null,q=e("#employeeExitDate")?.value||null,H=!!e("#employeeActive")?.checked,c=e("#employeeUser")?.value||null;let u=[];const d=e("#employeeProjects");d&&(u=Array.from(d.selectedOptions).map(t=>t.value).filter(Boolean));const r=e("#employeePhoto");let i=null;r&&r.files&&r.files[0]&&(i=r.files[0]);const o=e("#createEmployeeError"),p=e("#createEmployeeOk");if(o&&(o.textContent=""),p&&(p.style.display="none"),!a){o&&(o.textContent="El nombre es obligatorio.");return}if(!c){o&&(o.textContent="Debe seleccionar un usuario asociado.");return}try{const t=new FormData;t.append("name",a),t.append("fatherSurname",l),t.append("motherSurname",h),t.append("rut",v),t.append("mail",f),t.append("phone",S),t.append("secondaryPhone",b),t.append("gender",k),t.append("nationality",E),t.append("maritalStatus",D),t.append("studyLevel",A),t.append("profession",L),t.append("previtionalSystem",M),t.append("healthSystem",P),t.append("paymentMethod",N),t.append("bankName",T),t.append("bankAccountType",g),t.append("bankAccountNumber",w),t.append("contractType",x),t.append("workSchedule",C),t.append("shiftSystem",B),t.append("position",j),t.append("address",I),t.append("hireDate",F),t.append("birthDate",O),t.append("exitDate",q),t.append("active",H),t.append("userId",c),u.forEach(m=>t.append("projectIds",m)),i&&t.append("photo",i);const y=await W("/api/employees/create",{method:"POST",body:t});if(!y.ok){const m=await y.text().catch(()=>"");throw new Error(m||"No se pudo crear el empleado")}p&&(p.style.display="block"),setTimeout(()=>{s(),G("/private/employees/table-view")},600)}catch(t){o&&(o.textContent=t.message)}}function z(){e("#createEmployeeBtn")?.addEventListener("click",R),e("#closeCreateEmployee")?.addEventListener("click",s),e("#cancelCreateEmployee")?.addEventListener("click",s),e("#createEmployeeForm")?.addEventListener("submit",U),document.addEventListener("keydown",n=>{n.key==="Escape"&&s()})}(function(){z()})();
