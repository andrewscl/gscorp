import{f as R}from"../../auth.js";import{n as G}from"../../navigation-handler.js";console.log("create-employee.js cargado");const t=n=>document.querySelector(n);async function z(n){n.preventDefault();const l=n.submitter||t('#submitCreateEmployee button[type="submit"]');l&&(l.disabled=!0);const m=t("#employeeName")?.value?.trim(),u=t("#employeeFatherSurname")?.value?.trim()||null,c=t("#employeeMotherSurname")?.value?.trim()||null,y=t("#employeeRut")?.value?.trim()||null,d=t("#employeeMail")?.value?.trim()||null,f=t("#employeePhone")?.value?.trim()||null,h=t("#employeeSecondaryPhone")?.value?.trim()||null,v=t("#employeeGender")?.value?.trim()||null,S=t("#employeeNationality")?.value?.trim()||null,b=t("#employeeMaritalStatus")?.value?.trim()||null,E=t("#employeeStudyLevel")?.value?.trim()||null;let i=[];const k=t("#employeeProfessions");k&&(i=Array.from(k.selectedOptions).map(e=>e.value).filter(Boolean));const P=t("#employeePrevitionalSystem")?.value?.trim()||null,I=t("#employeePensionEntity")?.value?.trim()||null,A=t("#employeeHealthSystem")?.value?.trim()||null,C=t("#employeeHealthEntity")?.value?.trim()||null,D=t("#employeePaymentMethod")?.value?.trim()||null,g=t("#employeeBank")?.value?.trim()||null,w=t("#employeeBankAccountType")?.value?.trim()||null,T=t("#employeeBankAccountNumber")?.value?.trim()||null,B=t("#employeeContractType")?.value?.trim()||null,M=t("#employeeWorkSchedule")?.value?.trim()||null,N=t("#employeeShiftSystem")?.value?.trim()||null,j=t("#employeeShiftPattern")?.value?.trim()||null,L=t("#employeePosition")?.value?.trim()||null,x=t("#employeeAddress")?.value?.trim()||null,F=t("#employeeHireDate")?.value||null,O=t("#employeeBirthDate")?.value||null;let H=[];const q=t("#employeeProjects");q&&(H=Array.from(q.selectedOptions).map(e=>e.value).filter(Boolean));const p=t("#employeePhoto");let s=null;p&&p.files&&p.files[0]&&(s=p.files[0]);const o=t("#createEmployeeError"),r=t("#createEmployeeOk");if(o&&(o.textContent=""),r&&(r.style.display="none"),!m){o&&(o.textContent="El nombre es obligatorio."),l&&(l.disabled=!1);return}try{const e=new FormData;e.append("name",m),u&&e.append("fatherSurname",u),c&&e.append("motherSurname",c),y&&e.append("rut",y),d&&e.append("mail",d),f&&e.append("phone",f),h&&e.append("secondaryPhone",h),v&&e.append("gender",v),S&&e.append("nationalityId",S),b&&e.append("maritalStatus",b),E&&e.append("studyLevel",E),Array.isArray(i)&&i.length>0&&i.forEach(a=>e.append("professionIds",a)),P&&e.append("previtionalSystem",P),I&&e.append("pensionEntity",I),A&&e.append("healthSystem",A),C&&e.append("healthEntity",C),D&&e.append("paymentMethod",D),g&&e.append("bankId",g),w&&e.append("bankAccountType",w),T&&e.append("bankAccountNumber",T),B&&e.append("contractType",B),M&&e.append("workSchedule",M),N&&e.append("shiftSystem",N),j&&e.append("shiftPatternId",j),L&&e.append("positionId",L),x&&e.append("address",x),F&&e.append("hireDate",F),O&&e.append("birthDate",O),H.forEach(a=>e.append("projectIds",a)),s&&e.append("photo",s);const W=await R("/api/employees/create",{method:"POST",body:e});if(!W.ok){const a=await W.text().catch(()=>"");throw new Error(a||"No se pudo crear el empleado")}r&&(r.style.display="block"),setTimeout(()=>{G("/private/employees/table-view")},600)}catch(e){o&&(o.textContent=e.message)}}function J(n){n.preventDefault(),G("/private/employees/table-view")}function K(){t("#createEmployeeForm")?.addEventListener("submit",z),t("#cancelCreateEmployee")?.addEventListener("click",J)}(function(){K()})();
