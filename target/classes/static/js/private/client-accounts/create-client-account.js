import{f as h}from"../../auth.js";import{n as g}from"../../navigation-handler.js";console.log("create-client-account.js cargado");const c=e=>document.querySelector(e);function s(e,n,t="error"){e&&(e.className="form-message",t==="ok"?e.classList.add("form-ok"):e.classList.add("form-error"),e.textContent=n)}function y(e){e&&(e.className="form-message",e.textContent="")}async function A(e){e.preventDefault();const n=c("#createClientAccountForm"),t=c("#createClientAccountMessage"),a=c('#createClientAccountForm button[type="submit"]');y(t);const u=c("#clientAccountName")?.value?.trim(),m=c("#clientAccountClient"),l=m?m.value:"",d=n?n.querySelector('input[name="clientId"]'):null,f=l&&l!==""?l:d?d.value:null,p=c("#clientAccountNotes")?.value?.trim()||null;if(!u){s(t,"El nombre de la cuenta es obligatorio.");return}if(!f){s(t,"Debe seleccionar un cliente.");return}const v={name:u,clientId:Number(f),notes:p};a&&(a.disabled=!0);try{const o=await h("/api/client-accounts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(o.ok){s(t,"Cuenta creada correctamente. Redirigiendo…","ok"),setTimeout(()=>g("/private/client-accounts/table-view"),700);return}let i=`Error ${o.status}`;try{const r=await o.json();r&&r.message?i=r.message:typeof r=="string"?i=r:i=JSON.stringify(r)}catch{const b=await o.text().catch(()=>"");b&&(i=b)}s(t,`No se pudo crear la cuenta: ${i}`)}catch(o){s(t,`Error de red: ${o.message||o}`),console.error("create-client-account fetch error:",o)}finally{a&&(a.disabled=!1)}}function C(){const e=c("#createClientAccountForm");e?(e.addEventListener("submit",A),console.log("Submit handler vinculado al formulario createClientAccountForm")):console.warn("Form createClientAccountForm no encontrado - el JS no podrá interceptar submits");const n=c(".btn-secondary");n&&n.addEventListener("click",t=>{t.preventDefault();const a=n.getAttribute("data-path")||n.getAttribute("href")||"/private/client-accounts/table-view";g(a)})}(function(){document.addEventListener("DOMContentLoaded",()=>{C(),setTimeout(()=>c("#clientAccountName")?.focus(),50)})})();
