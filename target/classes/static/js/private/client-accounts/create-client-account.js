import{f as y}from"../../auth.js";import{n as p}from"../../navigation-handler.js";console.log("create-client-account.js cargado");const n=e=>document.querySelector(e);function s(e,c,r="error"){e&&(e.className="form-message",r==="ok"?e.classList.add("form-ok"):e.classList.add("form-error"),e.textContent=c)}function A(e){e&&(e.className="form-message",e.textContent="")}async function C(e){e.preventDefault();const c=n("#clientAccountName"),r=n("#clientAccountClient"),l=n("#createClientAccountForm"),a=n("#createClientAccountMessage"),u=n('#createClientAccountForm button[type="submit"]');A(a);const m=c?.value?.trim(),f=r?r.value:"",d=l?l.querySelector('input[name="clientId"]'):null,g=f&&f!==""?f:d?d.value:null,h=n("#clientAccountNotes")?.value?.trim()||null;if(!m){s(a,"El nombre de la cuenta es obligatorio.");return}if(!g){s(a,"Debe seleccionar un cliente.");return}const v={name:m,clientId:Number(g),notes:h};u&&(u.disabled=!0);try{const t=await y("/api/client-accounts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!t)throw new Error("No response from server");if(t.ok){s(a,"Cuenta creada correctamente. Redirigiendoâ€¦","ok"),setTimeout(()=>p("/private/client-accounts/table-view"),700);return}let i=`Error ${t.status}`;try{const o=await t.json();o&&o.message?i=o.message:typeof o=="string"?i=o:i=JSON.stringify(o)}catch{const b=await t.text().catch(()=>"");b&&(i=b)}s(a,`No se pudo crear la cuenta: ${i}`)}catch(t){s(a,`Error de red: ${t.message||t}`),console.error("create-client-account fetch error:",t)}finally{u&&(u.disabled=!1)}}function N(){const e=n("#createClientAccountForm");if(!e){console.warn("create-client-account: form no encontrado");return}if(e.__ccaBound)return;e.__ccaBound=!0,e.addEventListener("submit",C);const c=n(".btn-secondary");c&&c.addEventListener("click",r=>{r.preventDefault();const l=c.getAttribute("data-path")||c.getAttribute("href")||"/private/client-accounts/table-view";p(l)}),setTimeout(()=>n("#clientAccountName")?.focus(),50),console.log("create-client-account: bindings aplicados")}(function(){N()})();
