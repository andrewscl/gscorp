import{f as h}from"../../auth.js";import{n as d}from"../../navigation-handler.js";console.log("edit-client-account.js cargado");const n=t=>document.querySelector(t);function k(){const t=n(".meta-id span");if(!t)return null;const o=t.textContent.trim(),e=Number(o);return Number.isFinite(e)?e:null}function r(t,o,e="error"){t&&(t.className="form-message",t.textContent=o,e==="ok"?(t.classList.add("form-ok"),t.classList.remove("form-error")):(t.classList.add("form-error"),t.classList.remove("form-ok")))}function N(t){t&&(t.className="form-message",t.textContent="")}async function w(t){t.preventDefault(),console.log("onSubmitEdit fired");const o=n("#editClientAccountForm"),e=n("#editClientAccountMessage"),f=n("#editClientAccountError"),s=n("#editClientAccountOk"),l=n("#saveClientAccountBtn");N(e),f&&(f.textContent=""),s&&(s.style.display="none");const m=k();if(!m){r(e,"ID de cuenta no encontrado.","error");return}const g=n("#clientAccountName")?.value?.trim(),p=n("#clientAccountClient"),u=p?p.value:"",v=o?o.querySelector('input[name="clientId"]'):null,b=u&&u!==""?u:v?v.value:null,A=n("#clientAccountNotes")?.value?.trim()||null;if(!g){r(e,"El nombre es obligatorio.");return}if(!b){r(e,"Debe seleccionar un cliente.");return}const E={name:g,clientId:Number(b),notes:A};l&&(l.disabled=!0);try{const c=await h(`/api/client-accounts/${m}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(c.ok){s?(s.style.display="block",s.textContent="Guardado âœ…"):r(e,"Guardado correctamente.","ok"),setTimeout(()=>d("/private/client-accounts/table-view"),700);return}let a=`Error ${c.status}`;try{const i=await c.json();i&&i.message?a=i.message:typeof i=="string"?a=i:a=JSON.stringify(i)}catch{const y=await c.text().catch(()=>"");y&&(a=y)}r(e,`No se pudo guardar: ${a}`,"error")}catch(c){r(e,`Error de red: ${c.message||c}`,"error"),console.error("edit-client-account fetch error:",c)}finally{l&&(l.disabled=!1)}}function L(t){t.preventDefault();const o=t.currentTarget.getAttribute("data-path")||"/private/client-accounts/table-view";d(o)}function C(){const t=n("#editClientAccountForm");if(!t){console.warn("edit-client-account: form no encontrado");return}if(t.__editClientAccountBound){console.log("edit-client-account: ya vinculado, saltando");return}t.__editClientAccountBound=!0,t.addEventListener("submit",w),n("#cancelEditClientAccountBtn")?.addEventListener("click",L),document.addEventListener("keydown",o=>{o.key==="Escape"&&d("/private/client-accounts/table-view")}),setTimeout(()=>n("#clientAccountName")?.focus(),70),console.log("edit-client-account: bindings aplicados")}(function(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>C()):C()})();
