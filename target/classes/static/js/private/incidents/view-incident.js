import{n as d}from"../../navigation-handler.js";import"../../auth.js";function l(){const e=document.querySelector(".actions .vs-btn.vs-secondary[data-path]")||document.querySelector('[data-path="/private/incidents/table-view"]');e&&e.addEventListener("click",o=>{o.preventDefault();const t=e.getAttribute("data-path")||"/private/incidents/table-view";if(typeof d=="function")try{d(t)}catch(n){console.warn("[view-incident] navigateTo falló, usando location.href",n),window.location.href=t}else window.location.href=t})}function p(){const e=document.createElement("div");e.className="vi-overlay",e.style.cssText="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);z-index:10000;padding:20px;",e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true");const o=document.createElement("div");o.style.cssText="max-width:calc(100% - 40px);max-height:calc(100% - 40px);position:relative;display:flex;align-items:center;justify-content:center;";const t=document.createElement("img");t.style.cssText="max-width:100%;max-height:100%;border-radius:8px;box-shadow:0 6px 30px rgba(0,0,0,0.45);background:#fff;";const n=document.createElement("button");n.type="button",n.textContent="×",n.setAttribute("aria-label","Cerrar"),n.style.cssText="position:absolute;top:8px;right:8px;width:36px;height:36px;border-radius:6px;background:rgba(255,255,255,0.95);border:none;font-size:22px;cursor:pointer;",o.appendChild(t),o.appendChild(n),e.appendChild(o);function i(){e.parentNode&&e.parentNode.removeChild(e),document.removeEventListener("keydown",a)}function a(r){r.key==="Escape"&&i()}return e.addEventListener("click",r=>{r.target===e&&i()}),n.addEventListener("click",i),{open(r,s){t.src=r,t.alt=s||"",document.body.appendChild(e),document.addEventListener("keydown",a),n.focus()},close:i}}function u(){const e=Array.from(document.querySelectorAll(".incident-photo-thumb"));if(!e.length)return;const o=p();e.forEach(t=>{const n=t.closest("a");t.style.cursor="zoom-in",t.addEventListener("click",i=>{i.preventDefault();const a=n&&n.getAttribute("href")||t.getAttribute("src")||t.getAttribute("data-src");if(!a){console.warn("[view-incident] imagen sin src disponible");return}try{o.open(a,t.alt||"Foto incidente")}catch(r){console.error("[view-incident] error abriendo lightbox",r)}}),t.addEventListener("error",()=>{t.style.opacity="0.6",t.style.filter="grayscale(40%)"})})}function g(){const e=document.getElementById("incidentMap"),o=document.getElementById("incidentLat"),t=document.getElementById("incidentLon");if(!e||!o||!t)return;const n=parseFloat(o.value),i=parseFloat(t.value);if(!n||!i||Number.isNaN(n)||Number.isNaN(i)){e.innerHTML="<div style='padding:1em;text-align:center;color:#888'>No hay coordenadas para mostrar el mapa.</div>";return}if(window.google&&window.google.maps){const a=new google.maps.Map(e,{center:{lat:n,lng:i},zoom:16,mapTypeId:"roadmap",disableDefaultUI:!0});new google.maps.Marker({position:{lat:n,lng:i},map:a}),e._google_map=a}else e.innerHTML="<div style='padding:1em;text-align:center;color:#b00020'>Google Maps no cargado</div>"}function c(){try{l(),u(),g()}catch(e){console.error("[view-incident] init error",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();document.addEventListener("content:loaded",c);
