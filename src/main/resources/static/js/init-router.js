import{n as l}from"./navigation-handler.js";import{s as d}from"./router.js";import{s as m}from"./mega-menu.js";import{s as u}from"./slideshow-video.js";import{s as p}from"./chat/chat.js";import{f as a}from"./auth.js";function s(t){document.documentElement.classList.remove("no-scroll"),document.body.classList.remove("no-scroll"),requestAnimationFrame(()=>requestAnimationFrame(()=>{const e=new URL(t||location.href,location.origin).hash?.slice(1),n=()=>window.scrollTo({top:0,behavior:"auto"}),r=document.getElementById("content"),c=r&&getComputedStyle(r).overflowY!=="visible";if(e){const i=document.getElementById(decodeURIComponent(e));if(i){i.scrollIntoView({behavior:"smooth",block:"start"});return}}c&&r.scrollTo({top:0,behavior:"auto"}),n()}))}async function g(){if(document.body.getAttribute("data-layout")=="private")try{const[t,o]=await Promise.all([a("/private/sidebar?fragment=1"),a("/private/topbar?fragment=1")]);if(t.status===401||o.status===401){localStorage.removeItem("jwt"),window.location.href="/auth/signin";return}if(t.ok){const e=await t.text(),n=document.getElementById("sidebar");n&&(n.innerHTML=e),document.dispatchEvent(new CustomEvent("sidebar:loaded"))}if(o.ok){const e=await o.text(),n=document.querySelector(".topbar");n&&(n.innerHTML=e),document.dispatchEvent(new CustomEvent("topbar:loaded"))}}catch(t){console.warn("[init-router] No se pudieron cargar sidebar/topbar",t)}}window.initRouter=async()=>{window.__routeScrollBound||(document.addEventListener("route:loaded",o=>{const e=o.detail?.path||location.pathname+location.hash;s(e)}),window.addEventListener("popstate",()=>s(location.href)),window.__routeScrollBound=!0),console.log("Router reinicializado"),d(),await g();let t=sessionStorage.getItem("postLoginTarget");if(!t){const o=new URLSearchParams(window.location.search);t=decodeURIComponent(o.get("target")),console.log("Target detectado:",t),t&&sessionStorage.setItem("postLoginTarget",t)}t?(sessionStorage.removeItem("postLoginTarget"),console.log("[init-router] Redirigiendo a:",t),l(t,!0)):console.log("[init-router] Reiniciando router",t),m(),u(),p()};window.initRouter();
