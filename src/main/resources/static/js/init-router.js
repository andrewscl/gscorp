import{n as l}from"./navigation-handler.js";import{s as d}from"./router.js";import{s as m}from"./mega-menu.js";import{s as u}from"./slideshow-video.js";import{s as p}from"./chat/chat.js";import{f as a}from"./auth.js";function s(t){document.documentElement.classList.remove("no-scroll"),document.body.classList.remove("no-scroll"),requestAnimationFrame(()=>requestAnimationFrame(()=>{const o=new URL(t||location.href,location.origin).hash?.slice(1),n=()=>window.scrollTo({top:0,behavior:"auto"}),r=document.getElementById("content"),c=r&&getComputedStyle(r).overflowY!=="visible";if(o){const i=document.getElementById(decodeURIComponent(o));if(i){i.scrollIntoView({behavior:"smooth",block:"start"});return}}c&&r.scrollTo({top:0,behavior:"auto"}),n()}))}async function f(){if(document.body.getAttribute("data-layout")=="private")try{const[t,e]=await Promise.all([a("/private/sidebar?fragment=1"),a("/private/topbar?fragment=1")]);if(t.status===401||e.status===401){localStorage.removeItem("jwt"),window.location.href="/auth/signin";return}if(t.ok){const o=await t.text(),n=document.getElementById("sidebar");n&&(n.innerHTML=o),document.dispatchEvent(new CustomEvent("sidebar:loaded"))}if(e.ok){const o=await e.text(),n=document.querySelector(".topbar");n&&(n.innerHTML=o),document.dispatchEvent(new CustomEvent("topbar:loaded"))}}catch(t){console.warn("[init-router] No se pudieron cargar sidebar/topbar",t)}}window.initRouter=async()=>{window.__routeScrollBound||(document.addEventListener("route:loaded",e=>{const o=e.detail?.path||location.pathname+location.hash;s(o)}),window.addEventListener("popstate",()=>s(location.href)),window.__routeScrollBound=!0),console.log("Router reinicializado"),d(),await f();const t=sessionStorage.getItem("postLoginTarget");t||(t=new URLSearchParams(window.location.search).get("target"),t&&sessionStorage.setItem("postLoginTarget",t)),t?(sessionStorage.removeItem("postLoginTarget"),console.log("[init-router] Redirigiendo a:",t),l(t,!0)):console.log("[init-router] Reiniciando router",t),m(),u(),p()};window.initRouter();
