import{n as d}from"./navigation-handler.js";import{s as l}from"./router.js";import{s as u}from"./mega-menu.js";import{s as m}from"./slideshow-video.js";import{s as p}from"./chat/chat.js";import{f as i}from"./auth.js";function s(t){document.documentElement.classList.remove("no-scroll"),document.body.classList.remove("no-scroll"),requestAnimationFrame(()=>requestAnimationFrame(()=>{const e=new URL(t||location.href,location.origin).hash?.slice(1),n=()=>window.scrollTo({top:0,behavior:"auto"}),o=document.getElementById("content"),c=o&&getComputedStyle(o).overflowY!=="visible";if(e){const a=document.getElementById(decodeURIComponent(e));if(a){a.scrollIntoView({behavior:"smooth",block:"start"});return}}c&&o.scrollTo({top:0,behavior:"auto"}),n()}))}async function f(){if(document.body.getAttribute("data-layout")=="private")try{const[t,r,e]=await Promise.all([i("/private/sidebar?fragment=1"),i("/private/topbar?fragment=1"),i("/private/dashboard?fragment=1")]);if(t.status===401||r.status===401||e.status===401){localStorage.removeItem("jwt"),window.location.href="/auth/signin";return}if(t.ok){const n=await t.text(),o=document.getElementById("sidebar");o&&(o.innerHTML=n),document.dispatchEvent(new CustomEvent("sidebar:loaded"))}if(r.ok){const n=await r.text(),o=document.querySelector(".topbar");o&&(o.innerHTML=n),document.dispatchEvent(new CustomEvent("topbar:loaded"))}if(e.ok){const n=await e.text(),o=document.querySelector(".content");o&&(o.innerHTML=n),document.dispatchEvent(new CustomEvent("content:loaded"))}}catch(t){console.warn("[init-router] No se pudieron cargar sidebar/topbar",t)}}window.initRouter=async()=>{window.__routeScrollBound||(document.addEventListener("route:loaded",r=>{const e=r.detail?.path||location.pathname+location.hash;s(e)}),window.addEventListener("popstate",()=>s(location.href)),window.__routeScrollBound=!0),console.log("Router reinicializado"),l(),await f();const t=sessionStorage.getItem("postLoginTarget");t?(sessionStorage.removeItem("postLoginTarget"),console.log("[init-router] Redirigiendo a:",t),d(t,!0)):console.log("[init-router] Reiniciando router",t),u(),m(),p()};window.initRouter();
