import{f as d}from"../auth.js";import{n as m}from"../navigation-handler.js";console.log("create-user.js cargado");const t=e=>document.querySelector(e),p=e=>Array.from(document.querySelectorAll(e));function f(){const e=t("#createUserModal");e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>t("#newUsername")?.focus(),0))}function a(){const e=t("#createUserModal");e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),t("#createUserForm")?.reset(),t("#createUserError").textContent="",t("#createUserOk").style.display="none",t("#roleChoices")?.replaceChildren())}async function y(){const e=await d("/api/roles/all");if(!e.ok)throw new Error("No se pudieron cargar los roles");return e.json()}function h(e){const s=t("#roleChoices");s.innerHTML="",e.forEach(n=>{const c=`role_${n.id}`,o=document.createElement("label");o.className="role-option",o.innerHTML=`
      <input type="checkbox" name="roleId" value="${n.id}" id="${c}"/>
      <span>${n.name}</span>
    `,s.appendChild(o)})}async function v(){try{f();const e=await y();h(e)}catch(e){t("#createUserError").textContent=e.message}}async function w(e){e.preventDefault();const s=t("#newUsername")?.value.trim(),n=t("#newMail")?.value.trim(),c=t("#newPassword")?.value,o=p('input[name="roleId"]:checked').map(r=>Number(r.value)),i=t("#createUserError"),l=t("#createUserOk");i.textContent="",l.style.display="none";try{const r=await d("/api/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,mail:n,password:c,roleIds:o})});if(!r.ok){const u=await r.text();throw new Error(u||"No se pudo crear el usuario")}l.style.display="block",setTimeout(()=>{a(),m("/private/admin/users")},600)}catch(r){i.textContent=r.message}}function b(){t("#createUserBtn")?.addEventListener("click",v),t("#closeCreateUser")?.addEventListener("click",a),t("#cancelCreateUser")?.addEventListener("click",a),t("#createUserForm")?.addEventListener("submit",w),document.addEventListener("keydown",e=>{e.key==="Escape"&&a()})}(function(){b()})();
