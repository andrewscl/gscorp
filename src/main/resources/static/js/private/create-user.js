import{f as l}from"../auth.js";import{n as u}from"../navigation-handler.js";console.log("create-user.js cargado");const t=e=>document.querySelector(e),m=e=>Array.from(document.querySelectorAll(e));function p(){const e=t("#createUserModal");e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>t("#newUsername")?.focus(),0))}function a(){const e=t("#createUserModal");e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),t("#createUserForm")?.reset(),t("#createUserError").textContent="",t("#createUserOk").style.display="none",t("#roleChoices")?.replaceChildren())}async function f(){const e=await l("/api/roles/all");if(!e.ok)throw new Error("No se pudieron cargar los roles");return e.json()}function y(e){const s=t("#roleChoices");s.innerHTML="",e.forEach(o=>{const c=`role_${o.id}`,r=document.createElement("label");r.className="role-option",r.innerHTML=`
      <input type="checkbox" name="roleId" value="${o.id}" id="${c}"/>
      <span>${o.name}</span>
    `,s.appendChild(r)})}async function h(){try{p();const e=await f();y(e)}catch(e){t("#createUserError").textContent=e.message}}async function b(e){e.preventDefault();const s=t("#newUsername")?.value.trim(),o=t("#newPassword")?.value,c=m('input[name="roleId"]:checked').map(n=>Number(n.value)),r=t("#createUserError"),i=t("#createUserOk");r.textContent="",i.style.display="none";try{const n=await l("/api/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:o,roleIds:c})});if(!n.ok){const d=await n.text();throw new Error(d||"No se pudo crear el usuario")}i.style.display="block",setTimeout(()=>{a(),u("/private/admin/users")},600)}catch(n){r.textContent=n.message}}function k(){t("#createUserBtn")?.addEventListener("click",h),t("#closeCreateUser")?.addEventListener("click",a),t("#cancelCreateUser")?.addEventListener("click",a),t("#createUserForm")?.addEventListener("submit",b),document.addEventListener("keydown",e=>{e.key==="Escape"&&a()})}(function(){k()})();
