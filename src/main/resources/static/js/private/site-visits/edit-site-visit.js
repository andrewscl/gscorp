import{f as g}from"../../auth.js";import{n as y}from"../../navigation-handler.js";const a=document.getElementById("editSiteSupervisionVisitForm");a&&a.addEventListener("submit",async e=>{e.preventDefault();const i=a.querySelector('input[name="id"]')?.value||document.querySelector(".meta-id span")?.textContent?.trim();if(!i){alert("No se pudo determinar el ID de la visita.");return}const t=new FormData(a),l=document.getElementById("editVisitError"),u=document.getElementById("editVisitOk");l.textContent="",u.style.display="none";try{const o=await g(`/api/site-supervision-visits/update/${i}`,{method:"POST",body:t,credentials:"same-origin"});if(!o.ok){const p=await o.text().catch(()=>"");throw new Error(p||`No se pudo guardar (HTTP ${o.status})`)}u.style.display="",setTimeout(()=>y("/private/site-supervision-visits/table-view",!0),1300)}catch(o){l.textContent=o.message||"Error al guardar los cambios."}});const n=document.getElementById("getLocationBtn"),m=document.getElementById("visitLat"),v=document.getElementById("visitLon");n&&m&&v&&n.addEventListener("click",async()=>{if(!navigator.geolocation){alert("Geolocalización no soportada por tu navegador.");return}n.disabled=!0,n.textContent="Obteniendo ubicación...",navigator.geolocation.getCurrentPosition(e=>{m.value=e.coords.latitude,v.value=e.coords.longitude,n.textContent="Ubicación obtenida ✅",setTimeout(()=>{n.textContent="Obtener ubicación actual",n.disabled=!1},1500),alert(`Precisión estimada: ${Math.round(e.coords.accuracy)} metros`)},e=>{alert("No se pudo obtener la ubicación: "+e.message),n.textContent="Obtener ubicación actual",n.disabled=!1},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});const r=document.getElementById("photoInput"),s=document.getElementById("videoInput"),c=document.getElementById("photoPreview"),d=document.getElementById("videoPreview");r&&c&&r.addEventListener("change",()=>{c.innerHTML="";const e=r.files&&r.files[0];if(e){const i=URL.createObjectURL(e),t=document.createElement("img");t.src=i,t.style.maxWidth="180px",t.style.borderRadius="6px",c.appendChild(t)}});s&&d&&s.addEventListener("change",()=>{d.innerHTML="";const e=s.files&&s.files[0];if(e){const i=URL.createObjectURL(e),t=document.createElement("video");t.src=i,t.controls=!0,t.style.maxWidth="220px",t.style.borderRadius="6px",d.appendChild(t)}});
