import{f as s}from"../auth.js";import{n as c}from"../navigation-handler.js";console.log("create-role.js cargado");const t=e=>document.querySelector(e);function d(){const e=t("#createRoleModal");e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),setTimeout(()=>t("#newRole")?.focus(),0))}function n(){const e=t("#createRoleModal");if(!e)return;e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),t("#createRoleForm")?.reset(),t("#createRoleError").textContent="";const o=t("#createRoleOk");o&&(o.style.display="none")}async function u(e){e.preventDefault();const o=t("#createRoleError"),a=t("#createRoleOk");o&&(o.textContent=""),a&&(a.style.display="none");let i=t("#newRole")?.value?.trim();if(!i){o&&(o.textContent="El nombre del rol es obligatorio.");return}try{const r=await s("/api/roles/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:i,name:i})});if(!r.ok){const l=await r.text();throw new Error(l||`No se pudo crear el rol (HTTP ${r.status})`)}a&&(a.style.display="block"),setTimeout(()=>{n(),c("/private/admin/roles")},600)}catch(r){o&&(o.textContent=r.message||"No se pudo crear el rol.")}}function f(){t("#createRoleBtn")?.addEventListener("click",e=>{e.preventDefault?.(),d()}),t("#closeCreateRole")?.addEventListener("click",n),t("#cancelCreateRole")?.addEventListener("click",n),t("#createRoleForm")?.addEventListener("submit",u),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()}),t("#createRoleModal")?.addEventListener("click",e=>{e.target?.id==="createRoleModal"&&n()})}(function(){f()})();
