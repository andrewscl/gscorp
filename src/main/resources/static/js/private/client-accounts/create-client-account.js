import{f as h}from"../../auth.js";import{n as b}from"../../navigation-handler.js";console.log("create-client-account.js cargado (fetchWithAuth-only)");const r=(e,t=document)=>(t||document).querySelector(e);function l(e,t,n="error"){e&&(e.className="form-message",n==="ok"?e.classList.add("form-ok"):e.classList.add("form-error"),e.textContent=t)}function v(e){e&&(e.className="form-message",e.textContent="")}function y(e){const t=new FormData(e),n={};for(const[o,i]of t.entries())o==="clientId"&&i!==""?n[o]=Number(i):i===""?n[o]=null:n[o]=i;return n}async function A(e){e.preventDefault();const t=e.target,n=r('button[type="submit"]',t),o=r("#createClientAccountMessage",t);v(o);const i=r("#clientAccountName",t)?.value?.trim(),m=r("#clientAccountClient",t),u=m?m.value:"",f=t.querySelector('input[name="clientId"]'),g=u&&u!==""?u:f?f.value:null;if(r("#clientAccountNotes",t)?.value?.trim(),!i){l(o,"El nombre de la cuenta es obligatorio.");return}if(!g){l(o,"Debe seleccionar un cliente.");return}const p=y(t);n&&(n.disabled=!0);try{const c=await h("/api/client-accounts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(c.ok){l(o,"Cuenta creada correctamente. Redirigiendo…","ok"),setTimeout(()=>b("/private/client-accounts/table-view"),700);return}let s=`Error ${c.status}`;try{const a=await c.json();a&&a.message?s=a.message:typeof a=="string"?s=a:s=JSON.stringify(a)}catch{const d=await c.text().catch(()=>"");d&&(s=d)}l(o,`No se pudo crear la cuenta: ${s}`)}catch(c){l(o,`Error de red: ${c.message||c}`),console.error("create-client-account fetch error:",c)}finally{n&&(n.disabled=!1)}}function C(){const e=r("#createClientAccountForm");e?(e.addEventListener("submit",A),console.log("Submit handler vinculado al formulario createClientAccountForm")):console.warn("Form createClientAccountForm no encontrado - el JS no podrá interceptar submits");const t=r(".btn-secondary");t&&t.addEventListener("click",n=>{n.preventDefault();const o=t.getAttribute("data-path")||t.getAttribute("href")||"/private/client-accounts/table-view";b(o)})}document.addEventListener("DOMContentLoaded",()=>{C(),setTimeout(()=>r("#clientAccountName")?.focus(),50)});
