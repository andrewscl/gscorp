import{f as b}from"../../auth.js";import{n as f}from"../../navigation-handler.js";console.log("create-client-account.js cargado");const c=(t,e=document)=>e.querySelector(t);function i(t,e,n="error"){t&&(t.className="form-message",n==="ok"?t.classList.add("form-ok"):t.classList.add("form-error"),t.textContent=e)}function g(t){t&&(t.className="form-message",t.textContent="")}function p(t){const e=new FormData(t),n={};for(const[o,r]of e.entries())o==="clientId"&&r!==""?n[o]=Number(r):r===""?n[o]=null:n[o]=r;return n}async function v(t){t.preventDefault();const e=t.target,n=c('button[type="submit"]',e),o=c("#createClientAccountMessage",e);g(o);const r=c("#clientAccountName",e)?.value?.trim(),m=c("#clientAccountClient",e)?.value;if(c("#clientAccountNotes",e)?.value?.trim(),!r){i(o,"El nombre de la cuenta es obligatorio.");return}if(!m){i(o,"Debe seleccionar un cliente.");return}const d=p(e);n&&(n.disabled=!0);try{const a=await b("/api/client-accounts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(a.ok){i(o,"Cuenta creada correctamente. Redirigiendoâ€¦","ok"),setTimeout(()=>f("/private/client-accounts/table-view"),700);return}let u=`Error ${a.status}`;try{const s=await a.json();s&&s.message?u=s.message:typeof s=="string"&&(u=s)}catch{const l=await a.text().catch(()=>"");l&&(u=l)}i(o,`No se pudo crear la cuenta: ${u}`)}catch(a){i(o,`Error de red: ${a.message||a}`)}finally{n&&(n.disabled=!1)}}function h(){const t=c("#createClientAccountForm");t&&t.addEventListener("submit",v);const e=c(".btn-secondary");e&&e.addEventListener("click",n=>{n.preventDefault();const o=e.getAttribute("data-path")||e.getAttribute("href")||"/private/client-accounts/table-view";f(o)})}document.addEventListener("DOMContentLoaded",()=>{h(),setTimeout(()=>c("#clientAccountName")?.focus(),50)});
