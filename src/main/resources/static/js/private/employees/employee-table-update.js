import{f as E}from"../../auth.js";import{n as w}from"../../navigation-handler.js";const a=(e,t=document)=>t.querySelector(e),T="/private/employees/table-search",_="/private/employees/table-view";function L(e){const t=e||a(".employees-table tbody");if(!t)return;const r=(t.querySelector(".empty")?[]:Array.from(t.children).filter(l=>l.nodeName&&l.nodeName.toLowerCase()==="tr")).length,s=a(".employees-header .employees-count");s&&(s.textContent=`${r} registro${r===1?"":"s"}`)}let b=null,p=null;function S(){A();const e=a(".employees-table tbody"),t=a(".employees-table-container");e&&(L(e),b=new MutationObserver(n=>{let o=!1;for(const r of n)if(r.type==="childList"&&(r.addedNodes.length||r.removedNodes.length)){o=!0;break}o&&L(e)}),b.observe(e,{childList:!0,subtree:!1})),t&&(p=new MutationObserver(n=>{let o=!1;for(const r of n){if(r.type==="childList"&&(r.addedNodes.length||r.removedNodes.length)){for(const s of[...r.addedNodes,...r.removedNodes])if(s.nodeName&&s.nodeName.toLowerCase()==="tbody"){o=!0;break}}if(o)break}o&&setTimeout(()=>S(),50)}),p.observe(t,{childList:!0,subtree:!0}))}function A(){try{b&&(b.disconnect(),b=null),p&&(p.disconnect(),p=null)}catch{}}function q(){const e=a(".employees-table-container");!e||e.__employeesDeleg||(e.__employeesDeleg=!0,e.addEventListener("click",t=>{const n=t.target.closest(".action-btn, a[data-path], button[data-path]");if(!n)return;const o=n.dataset.path||n.getAttribute("href");o&&(t.preventDefault(),w(o,!0))}))}async function N({baseUrl:e,q:t,active:n,projectId:o,positionId:r,clientTz:s,applyBtn:l}){const c=new URLSearchParams;t&&c.set("q",t),n!=null&&String(n)!==""&&c.set("active",String(n)),o!=null&&String(o)!==""&&c.set("projectId",String(o)),r!=null&&String(r)!==""&&c.set("positionId",String(r)),s&&c.set("tz",s);const m=e+(c.toString()?`?${c.toString()}`:"");l&&(l.disabled=!0,l.classList.add("is-loading"));try{const d=await E(m,{method:"GET",credentials:"same-origin",headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"}});if(!d.ok){if(d.status===401||d.status===302){w("/login",!0);return}const i=await d.text().catch(()=>"");throw new Error(i||`HTTP ${d.status}`)}const v=await d.text(),u=document.createElement("div");u.innerHTML="<table>"+v.trim()+"</table>";const h=u.querySelector(".header-meta");let f=u.querySelector("tbody");if(!f){const i=u.querySelectorAll("tr");f=document.createElement("tbody"),i.forEach(g=>f.appendChild(g))}const y=a(".employees-table tbody");if(!y){w(_,!0);return}if(y.innerHTML=f.innerHTML,h){const i=a(".employees-header .header-meta");i&&i.replaceWith(h)}L(y)}finally{l&&(l.disabled=!1,l.classList.remove("is-loading"))}}function k(){const e=a("#applyFiltersBtn"),t=a("#filter-q"),n=a("#filter-status"),o=a("#filter-project"),r=a("#filter-position");e&&(e.hasAttribute("type")||e.setAttribute("type","button"),e.addEventListener("click",async s=>{s.preventDefault();const l=t?(t.value||"").trim():"",c=n?n.value:"";let m=null;c==="true"?m=!0:c==="false"&&(m=!1);const d=o&&o.value||"",v=r&&r.value||"";let u="";try{u=Intl.DateTimeFormat().resolvedOptions().timeZone||""}catch{u=""}const h=e.dataset.ajaxUrl||e.dataset.path||T;try{await N({baseUrl:h,q:l,active:m,projectId:d,positionId:v,clientTz:u,applyBtn:e})}catch(f){console.error("[employees] error fetching rows",f);const y=document.getElementById("employeesTableSearchError")||(()=>{const i=document.createElement("div");i.id="employeesTableSearchError",i.className="error";const g=a(".employees-header");return g?g.insertAdjacentElement("afterend",i):document.body.prepend(i),i})();y.textContent=f.message||"Error al obtener resultados."}}),t&&t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),e.click())}))}(function(){try{q(),k(),S()}catch(t){console.error("[employees] init failed",t)}})();
