import{f as z}from"../../auth.js";import{n as W}from"../../navigation-handler.js";console.log("edit-employee.js cargado");const t=n=>document.querySelector(n);async function G(n){n.preventDefault();const p=t("#employeeId")?.value?.trim(),r=t("#employeeName")?.value?.trim(),m=t("#employeeFatherSurname")?.value?.trim()||null,s=t("#employeeMotherSurname")?.value?.trim()||null,u=t("#employeeRut")?.value?.trim()||null,c=t("#employeeMail")?.value?.trim()||null,d=t("#employeePhone")?.value?.trim()||null,y=t("#employeeSecondaryPhone")?.value?.trim()||null,f=t("#employeeGender")?.value?.trim()||null,h=t("#employeeNationality")?.value?.trim()||null,v=t("#employeeMaritalStatus")?.value?.trim()||null,S=t("#employeeStudyLevel")?.value?.trim()||null;let a=[];const E=t("#employeeProfessions");E&&(a=Array.from(E.selectedOptions).map(e=>e.value).filter(Boolean));const b=t("#employeePrevitionalSystem")?.value?.trim()||null,k=t("#employeePensionEntity")?.value?.trim()||null,P=t("#employeeHealthSystem")?.value?.trim()||null,D=t("#employeeHealthEntity")?.value?.trim()||null,I=t("#employeePaymentMethod")?.value?.trim()||null,A=t("#employeeBank")?.value?.trim()||null,g=t("#employeeBankAccountType")?.value?.trim()||null,w=t("#employeeBankAccountNumber")?.value?.trim()||null,T=t("#employeeContractType")?.value?.trim()||null,x=t("#employeeWorkSchedule")?.value?.trim()||null,B=t("#employeeShiftSystem")?.value?.trim()||null,M=t("#employeeShiftPattern")?.value?.trim()||null,N=t("#employeePosition")?.value?.trim()||null,j=t("#employeeAddress")?.value?.trim()||null,C=t("#employeeHireDate")?.value||null,L=t("#employeeBirthDate")?.value||null,F=t("#employeeExitDate")?.value||null;let H=[];const O=t("#employeeProjects");O&&(H=Array.from(O.selectedOptions).map(e=>e.value).filter(Boolean));const o=t("#editEmployeeError"),i=t("#editEmployeeOk");if(o&&(o.textContent=""),i&&(i.style.display="none"),!r){o&&(o.textContent="El nombre es obligatorio.");return}try{const e=new FormData;e.append("id",p),e.append("name",r),m&&e.append("fatherSurname",m),s&&e.append("motherSurname",s),u&&e.append("rut",u),c&&e.append("mail",c),d&&e.append("phone",d),y&&e.append("secondaryPhone",y),f&&e.append("gender",f),h&&e.append("nationalityId",h),v&&e.append("maritalStatus",v),S&&e.append("studyLevel",S),Array.isArray(a)&&a.length>0&&a.forEach(l=>e.append("professionIds",l)),b&&e.append("previtionalSystem",b),k&&e.append("pensionEntity",k),P&&e.append("healthSystem",P),D&&e.append("healthEntity",D),I&&e.append("paymentMethod",I),A&&e.append("bankId",A),g&&e.append("bankAccountType",g),w&&e.append("bankAccountNumber",w),T&&e.append("contractType",T),x&&e.append("workSchedule",x),B&&e.append("shiftSystem",B),M&&e.append("shiftPatternId",M),N&&e.append("positionId",N),j&&e.append("address",j),C&&e.append("hireDate",C),L&&e.append("birthDate",L),F&&e.append("exitDate",F),H.forEach(l=>e.append("projectIds",l));const q=await z(`/api/employees/${p}`,{method:"PUT",body:e});if(!q.ok){const l=await q.text().catch(()=>"");throw new Error(l||"No se pudo actualizar el empleado")}i&&(i.style.display="block"),setTimeout(()=>{W("/private/employees/table-view")},600)}catch(e){o&&(o.textContent=e.message)}}function R(n){n.preventDefault(),W("/private/employees/table-view")}function U(){t("#editEmployeeForm")?.addEventListener("submit",G),t("#cancelEditEmployee")?.addEventListener("click",R)}(function(){U()})();
