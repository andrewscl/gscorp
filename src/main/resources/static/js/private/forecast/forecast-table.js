import{f as m}from"../../auth.js";import{n as w}from"../../navigation-handler.js";const h=500;window.__forecastTable||(window.__forecastTable={});window.__forecastTable.inited||(window.__forecastTable.inited=!1);function p(n){const t=new URLSearchParams;return Object.entries(n).forEach(([e,o])=>{if(o==null)return;const a=String(o).trim();a!==""&&t.set(e,a)}),t.toString()}function i(n,t=!1){try{w(n,t)}catch(e){console.warn("[forecast-table] navigateTo falló, usando location.href",e),window.location.href=n}}async function E(n){if(confirm("¿Confirma eliminar este forecast? Esta acción no se puede deshacer."))try{const t=await m(n,{method:"DELETE",credentials:"same-origin"});if(!t.ok){let e={};try{e=await t.json()}catch{}throw new Error(e?.error||`Error ${t.status}`)}i(window.location.pathname+window.location.search,!0)}catch(t){alert("No se pudo eliminar: "+(t.message||t))}}function g(n){const e=n.currentTarget.dataset.path||window.location.pathname,o=document.getElementById("filter-from")?.value,a=document.getElementById("filter-to")?.value,l=document.getElementById("filter-zone")?.value,d=document.getElementById("filter-page")?.value,r=document.getElementById("filter-size"),f=r&&r.value?r.value:h,c=p({from:o,to:a,zone:l,page:d,size:f}),u=c?e+"?"+c:e;i(u,!1)}function y(n){const t=n.target.closest(".action-btn");if(!t)return;const e=t.dataset.path||t.getAttribute("data-path"),o=t.dataset.action||t.getAttribute("data-action")||"";if(e){if(o==="delete"){E(e);return}i(e,!0)}}function b(n){if(n.key!=="Enter")return;const t=n.target.id;if(["filter-from","filter-to","filter-zone"].includes(t)){n.preventDefault();const e=document.getElementById("applyFiltersBtn");e&&e.click()}}function B(){if(window.__forecastTable.inited)return;window.__forecastTable.inited=!0;const n=document.getElementById("applyFiltersBtn");n&&n.addEventListener("click",g);const t=document.getElementById("createForecastBtn");t&&t.addEventListener("click",function(){const e=this.dataset.path||this.getAttribute("data-path");e&&i(e,!0)}),document.addEventListener("click",y),document.addEventListener("keydown",b)}function s(){B()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s();
