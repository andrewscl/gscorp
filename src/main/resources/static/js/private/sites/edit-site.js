import{f as g}from"../../auth.js";import{n as b}from"../../navigation-handler.js";const r=document.querySelector("#deleteSiteBtn");r&&r.addEventListener("click",async()=>{const t=r.getAttribute("data-id");if(!(!t||!window.confirm("¿Eliminar este sitio? Esta acción no se puede deshacer."))){r.disabled=!0;try{const a=await g(`/api/sites/${t}`,{method:"DELETE"});if(!a.ok){const o=await a.text().catch(()=>"");throw new Error(o||`No se pudo eliminar (HTTP ${a.status})`)}b("/private/sites/table-view",!0)}catch(a){alert(a.message||"Error al eliminar el sitio."),r.disabled=!1}}});const s=document.querySelector("#editSiteForm");s&&s.addEventListener("submit",async t=>{t.preventDefault();const c=s.querySelector('button[type="submit"]').getAttribute("data-id");if(!c)return;const a=new FormData(s),o={};a.forEach((i,n)=>{n==="active"?o[n]=s.querySelector("#siteActive").checked:o[n]=i});const d=document.getElementById("editSiteError"),l=document.getElementById("editSiteOk");d.textContent="",l.style.display="none";try{const i=await g(`/api/sites/${c}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const n=await i.text().catch(()=>"");throw new Error(n||`No se pudo guardar (HTTP ${i.status})`)}l.style.display="",b("/private/sites/table-view",!0)}catch(i){d.textContent=i.message||"Error al guardar el sitio."}});const e=document.getElementById("getLocationBtn"),u=document.getElementById("siteLat"),m=document.getElementById("siteLon");e&&u&&m&&e.addEventListener("click",()=>{if(!navigator.geolocation){alert("Geolocalización no soportada por tu navegador.");return}e.disabled=!0,e.textContent="Obteniendo ubicación...",navigator.geolocation.getCurrentPosition(t=>{u.value=t.coords.latitude,m.value=t.coords.longitude,e.textContent="Ubicación obtenida ✅",setTimeout(()=>{e.textContent="Obtener ubicación actual",e.disabled=!1},1500),alert(`Precisión estimada: ${Math.round(t.coords.accuracy)} metros`)},t=>{alert("No se pudo obtener la ubicación: "+t.message),e.textContent="Obtener ubicación actual",e.disabled=!1},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});
