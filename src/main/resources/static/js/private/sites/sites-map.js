import{f as u}from"../../auth.js";let i,r=[],d=[];function f(){const e=document.getElementById("site-map");if(!e||!window.google||!google.maps){a("No se pudo cargar Google Maps.");return}i=new google.maps.Map(e,{center:{lat:-33.45,lng:-70.65},zoom:8,mapTypeId:"roadmap"}),document.getElementById("site-select")?.addEventListener("change",E),y()}function a(e){const t=document.getElementById("site-map-error");t&&(t.textContent=e,t.style.display="block")}function h(){const e=document.getElementById("site-map-error");e&&(e.style.display="none")}function v(e){r.forEach(o=>o.setMap(null)),r=[],d=e;const t=document.getElementById("site-select");t&&(t.innerHTML='<option value="">Seleccionar sitio</option>');const n=new google.maps.LatLngBounds;e.forEach(o=>{if(typeof o.lat=="number"&&typeof o.lon=="number"){const s={lat:o.lat,lng:o.lon},m=document.createElement("div");m.innerHTML=`
        <div style="background-color: white; border: 1px solid black; padding: 5px; border-radius: 3px;">
          <strong>${o.name}</strong>
        </div>
      `;const c=new google.maps.marker.AdvancedMarkerElement({map:i,position:s,title:o.name,content:m}),g=new google.maps.InfoWindow({content:`<h4>${o.name}</h4><p>Dirección: ${o.address}</p><p>Zona horaria: ${o.timeZone}</p>`});if(c.addListener("click",()=>g.open(i,c)),r.push(c),n.extend(s),t){const l=document.createElement("option");l.value=o.id,l.textContent=o.name,t.appendChild(l)}}}),e.length>0?i.fitBounds(n):(i.setCenter({lat:-33.45,lng:-70.65}),i.setZoom(8),a("No hay sitios para mostrar.")),I()}function E(){const e=document.getElementById("site-select");if(!e)return;const t=e.value,n=d.find(o=>String(o.id)===t);n&&(i.setCenter({lat:n.lat,lng:n.lon}),i.setZoom(15))}async function y(){try{const e=await u("/api/sites/projections-by-user",{method:"GET",headers:{Accept:"application/json"}});if(!e.ok){a("Error al cargar sitios. Intente nuevamente.");return}const t=await e.json();if(h(),!Array.isArray(t)||!t.every(n=>n.id&&n.lat&&n.lon)){a("Datos de sitios inválidos.");return}v(t)}catch(e){console.error("Fallo al obtener sitios:",e),a("Error al cargar sitios. Intente nuevamente.")}}function p(e=0){window.google&&window.google.maps?f():e<10?setTimeout(()=>p(e+1),300+150*e):a("No se pudo cargar Google Maps. Intente más tarde.")}function I(){const e=document.getElementById("site-select");e&&(e.addEventListener("mouseover",t=>{const n=t.target.value;if(!n)return;const o=d.find(s=>String(s.id)===n);o&&r.forEach(s=>{s.getTitle()===o.name?s.setIcon("https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png"):s.setIcon("https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png")})}),e.addEventListener("mouseleave",()=>{r.forEach(t=>{t.setIcon("https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png")})}))}(function(){p()})();
