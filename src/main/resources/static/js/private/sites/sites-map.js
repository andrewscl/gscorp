let l,r=[],i=!1;function p(o,e){return new Promise((a,t)=>{if(window.google&&google.maps){console.log("[loadGoogleMapsAPI] Google Maps ya estaba disponible."),a();return}if(document.getElementById("google-maps-script")){console.log("[loadGoogleMapsAPI] Script ya existe en el DOM.");const g=setInterval(()=>{window.google&&google.maps&&(clearInterval(g),a())},200);return}const n=document.createElement("script");n.id="google-maps-script",n.src=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=marker&map_ids=${e}&callback=googleMapsLoaded&loading=async`,n.async=!0,n.defer=!0,n.setAttribute("loading","async"),window.googleMapsLoaded=()=>{console.log("[googleMapsLoaded] Google Maps cargado exitosamente."),a()},n.onerror=()=>{console.error("[loadGoogleMapsAPI] Error cargando Google Maps API."),t(new Error("No se pudo cargar Google Maps API"))},document.head.appendChild(n)})}function s(){if(i){console.log("[initMap] Mapa ya inicializado, no se hace nada.");return}const o=document.getElementById("site-map");if(console.log("[initMap] Inicializando mapa en el contenedor:",o),!o){console.error("[initMap] Contenedor del mapa no encontrado.");return}l=new google.maps.Map(o,{center:{lat:-33.45,lng:-70.65},zoom:8,mapTypeId:"roadmap",mapId:googleMapsConfig.mapId,disableDefaultUI:!0,renderer:"canvas"}),document.getElementById("site-select")?.addEventListener("change",d),console.log("[initMap] Mapa inicializado exitosamente."),i=!0}function c(o){const e=document.getElementById("site-map-error");e&&(e.textContent=o,e.style.display="block")}function d(){const o=document.getElementById("site-select");if(!o)return;const e=o.value,a=r.find(t=>String(t.id)===e);a&&(l.setCenter({lat:a.lat,lng:a.lon}),l.setZoom(15))}(function(){if(window.google&&google.maps)if(console.log("[init] Verificando google.maps:",{Map:google.maps?.Map,LatLng:google.maps?.LatLng,MapTypeId:google.maps?.MapTypeId}),google.maps.Map&&google.maps.LatLng){console.log("[init] Google Maps ya completamente cargados."),s();return}else console.warn("[init] Google Maps incompleto, recargando...");console.log("Google Maps Config:",googleMapsConfig),console.log("[init] IIFE iniciado"),p(googleMapsConfig.apiKey,googleMapsConfig.mapId).then(()=>{console.log("[init] Google Maps API lista. Inicializando mapa."),s()}).catch(e=>{console.error("[init] Error durante la carga de Google Maps:",e),c("No se pudo cargar Google Maps. Intente m√°s tarde.")})})();
