let i,g=[],l=!1;function c(e,o){return new Promise((a,t)=>{if(window.google&&google.maps){console.log("[loadGoogleMapsAPI] Google Maps ya estaba disponible."),a();return}if(document.getElementById("google-maps-script")){console.log("[loadGoogleMapsAPI] Script ya existe en el DOM.");const r=setInterval(()=>{window.google&&google.maps&&(clearInterval(r),a())},200);return}const n=document.createElement("script");n.id="google-maps-script",n.src=`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=marker&map_ids=${o}&callback=googleMapsLoaded&loading=async`,n.async=!0,n.defer=!0,n.setAttribute("loading","async"),window.googleMapsLoaded=()=>{console.log("[googleMapsLoaded] Google Maps cargado exitosamente."),a()},n.onerror=()=>{console.error("[loadGoogleMapsAPI] Error cargando Google Maps API."),t(new Error("No se pudo cargar Google Maps API"))},document.head.appendChild(n)})}function s(){if(l){console.log("[initMap] Mapa ya inicializado, no se hace nada.");return}const e=document.getElementById("site-map");if(console.log("[initMap] Inicializando mapa en el contenedor:",e),!e){console.error("[initMap] Contenedor del mapa no encontrado.");return}i=new google.maps.Map(e,{center:{lat:-33.45,lng:-70.65},zoom:8,mapTypeId:"roadmap",mapId:googleMapsConfig.mapId,disableDefaultUI:!0,renderer:"canvas"}),document.getElementById("site-select")?.addEventListener("change",p),console.log("[initMap] Mapa inicializado exitosamente."),l=!0}function d(e){const o=document.getElementById("site-map-error");o&&(o.textContent=e,o.style.display="block")}function p(){const e=document.getElementById("site-select");if(!e)return;const o=e.value,a=g.find(t=>String(t.id)===o);a&&(i.setCenter({lat:a.lat,lng:a.lon}),i.setZoom(15))}(function(){if(window.google&&google.maps){console.log("[init] Google Maps ya estaba cargada anteriormente."),s();return}console.log("Google Maps Config:",googleMapsConfig),console.log("[init] IIFE iniciado"),c(googleMapsConfig.apiKey,googleMapsConfig.mapId).then(()=>{console.log("[init] Google Maps API lista. Inicializando mapa."),s()}).catch(o=>{console.error("[init] Error durante la carga de Google Maps:",o),d("No se pudo cargar Google Maps. Intente m√°s tarde.")})})();
