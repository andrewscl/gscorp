console.log("signin.js cargado correctamente");function d(){const t=document.getElementById("username");t&&t.focus();const o=document.getElementById("password"),e=document.getElementById("togglePassword");e&&o&&e.addEventListener("click",function(){const n=o.getAttribute("type")==="password"?"text":"password";o.setAttribute("type",n),this.textContent=n==="password"?"Mostrar":"Ocultar"});const a=document.getElementById("loginBtn");a&&a.addEventListener("click",n=>{n.preventDefault(),l()})}d();async function l(){const t=document.getElementById("username").value,o=document.getElementById("password").value;try{const e=await fetch("/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:o})});if(!e.ok){const c=await e.text();throw new Error(c||"Credenciales invalidas")}const n=(await e.json()).token;localStorage.setItem("jwt",n);const r=u(n)?.roles||[];let s="/private/dashboard";r.includes("ROLE_ADMIN")?s="/admin/dashboard":r.includes("ROLE_CLIENT")&&(s="/private/home"),console.log("Llamando a navigateTo con:",s),(s.startsWith("/private/")||s.startsWith("/admin/"))&&sessionStorage.setItem("postLoginTarget",s);const i=g(s);window.location.href=`/shell/${i}`}catch(e){alert("Error al iniciar sesi√≥n: "+e.message)}}function u(t){try{const e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(e).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}catch(o){return console.error("Error al decodificar el token",o),null}}function g(t){if(t.startsWith("/auth/"))return"auth";if(t.startsWith("/private/"))return"private";if(t.startsWith("/admin/"))return"admin"}
