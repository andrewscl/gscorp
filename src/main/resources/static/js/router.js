import{f as v}from"./auth.js";const w="modulepreload",y=function(t){return"/"+t},m={},E=function(i,n,s){let u=Promise.resolve();if(n&&n.length>0){let f=function(e){return Promise.all(e.map(a=>Promise.resolve(a).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),r=o?.nonce||o?.getAttribute("nonce");u=f(n.map(e=>{if(e=y(e),e in m)return;m[e]=!0;const a=e.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${d}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":w,a||(l.as="script"),l.crossOrigin="",l.href=e,r&&l.setAttribute("nonce",r),document.head.appendChild(l),a)return new Promise((g,p)=>{l.addEventListener("load",g),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${e}`)))})}))}function c(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return u.then(o=>{for(const r of o||[])r.status==="rejected"&&c(r.reason);return i().catch(c)})};let h=!1;function b(){h||(h=!0,console.log("Router activado"),document.addEventListener("click",t=>{const i=t.target.closest("[data-path]");if(i){t.preventDefault();const n=i.dataset.path,s=i.dataset.target||n;s&&L(s)}}))}async function L(t,i=!1){const n=S(t),s=document.body.getAttribute("data-layout");if(t==="/public/home"){console.warn("[navigateTo] Redirigiendo a index-view para /public/home"),window.location.href="/public/home";return}if(!i&&n!==s){console.warn(`[navigateTo] Cambio de layout: 
                        ${s} -> ${n}`);const o=localStorage.getItem("jwt");if((n==="private"||n==="admin")&&o){sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${n}`;return}sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${n}`;return}try{const o=await P(t,n);if(!o)throw new Error("No content");const r=document.getElementById("content");if(!r)throw new Error("No se encontró el contenedor #content");r.innerHTML=o,r.querySelectorAll('script[type="module"]').forEach(e=>{const a=document.createElement("script");a.type="module",e.src?a.src=e.src:a.textContent=e.textContent,document.body.appendChild(a)}),window.history.pushState({},"",t),b(),console.log(`[navigateTo] Ruta cargada dinámicamente: ${t}`),t==="/public/contact"&&E(()=>import("./contact.js"),[]).then(({setupContact:e})=>{e(),console.log("[navigateTo] setupContact activado")})}catch(o){console.error(`[navigateTo] Error: ${o.message}`),alert("Error al navegar a la ruta solicitada.")}}function S(t){return t.startsWith("/auth/")?"auth":t.startsWith("/private/")||t.startsWith("/admin/")?"private":"public"}async function P(t,i){const n=localStorage.getItem("jwt"),s=t.includes("?")?"&":"?",u=`${t}${s}fragment=1`;return i==="private"&&n?v(u).then(c=>c.ok?c.text():null):fetch(u).then(c=>c.ok?c.text():null)}export{S as d,L as n,b as s};
