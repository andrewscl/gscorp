import{f as p}from"./auth.js";const w="modulepreload",y=function(t){return"/"+t},m={},E=function(c,e,l){let d=Promise.resolve();if(e&&e.length>0){let f=function(r){return Promise.all(r.map(a=>Promise.resolve(a).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=n?.nonce||n?.getAttribute("nonce");d=f(e.map(r=>{if(r=y(r),r in m)return;m[r]=!0;const a=r.endsWith(".css"),i=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${i}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":w,a||(u.as="script"),u.crossOrigin="",u.href=r,o&&u.setAttribute("nonce",o),document.head.appendChild(u),a)return new Promise((g,v)=>{u.addEventListener("load",g),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${r}`)))})}))}function s(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return d.then(n=>{for(const o of n||[])o.status==="rejected"&&s(o.reason);return c().catch(s)})};let h=!1;function b(){h||(h=!0,console.log("Router activado"),document.addEventListener("click",t=>{const c=t.target.closest("[data-path]");if(c){t.preventDefault();const e=c.dataset.path,l=c.dataset.target||e;l&&L(l)}}))}async function L(t,c=!1){const e=S(t),l=document.body.getAttribute("data-layout");if(t==="/public/home"){console.warn("[navigateTo] Redirigiendo a index-view para /public/home"),window.location.href="/public/home";return}if(!c&&e!==l){console.warn(`[navigateTo] Cambio de layout: 
                        ${l} -> ${e}`);const n=localStorage.getItem("jwt");if((e==="private"||e==="admin")&&n){sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${e}`;return}sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${e}`;return}try{const n=await P(t,e);if(!n)throw new Error("No content");const o=document.getElementById("content");if(!o)throw new Error("No se encontró el contenedor #content");o.innerHTML=n,o.querySelectorAll('script[type="module"]').forEach(a=>{const i=document.createElement("script");i.type="module",a.src?i.src=a.src:i.textContent=a.textContent,document.body.appendChild(i)});const r=()=>{document.dispatchEvent(new CustomEvent("route:loaded",{detail:{path:t}}))};window.history.pushState({},"",t),b(),console.log(`[navigateTo] Ruta cargada dinámicamente: ${t}`),t==="/public/contact"?E(()=>import("./contact.js"),[]).then(({setupContact:a})=>{a(),r(),console.log("[navigateTo] setupContact activado y finish enviado")}).catch(()=>r()):r()}catch(n){console.error(`[navigateTo] Error: ${n.message}`),alert("Error al navegar a la ruta solicitada.")}}function S(t){return t.startsWith("/auth/")?"auth":t.startsWith("/private/")||t.startsWith("/admin/")?"private":"public"}async function P(t,c){const e=localStorage.getItem("jwt"),l=t.includes("?")?"&":"?",d=`${t}${l}fragment=1`;return c==="private"&&e?p(d).then(s=>s.ok?s.text():null):fetch(d).then(s=>s.ok?s.text():null)}export{S as d,L as n,b as s};
