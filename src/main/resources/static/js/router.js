import{f as v}from"./auth.js";const y="modulepreload",w=function(t){return"/"+t},m={},E=function(s,e,c){let u=Promise.resolve();if(e&&e.length>0){let l=function(o){return Promise.all(o.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");u=l(e.map(o=>{if(o=w(o),o in m)return;m[o]=!0;const d=o.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${f}`))return;const i=document.createElement("link");if(i.rel=d?"stylesheet":y,d||(i.as="script"),i.crossOrigin="",i.href=o,a&&i.setAttribute("nonce",a),document.head.appendChild(i),d)return new Promise((h,p)=>{i.addEventListener("load",h),i.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})}))}function n(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return u.then(r=>{for(const a of r||[])a.status==="rejected"&&n(a.reason);return s().catch(n)})};let g=!1;function L(){g||(g=!0,console.log("Router activado"),document.addEventListener("click",t=>{const s=t.target.closest("[data-path]");if(s){t.preventDefault();const e=s.dataset.path,c=s.dataset.target||e;c&&S(c)}}))}async function S(t,s=!1){const e=$(t),c=document.body.getAttribute("data-layout");if(!s&&e!==c){console.warn(`[navigateTo] Cambio de layout: 
                        ${c} -> ${e}`);const n=localStorage.getItem("jwt");if((e==="private"||e==="admin")&&n){sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${e}`;return}sessionStorage.setItem("postLoginTarget",t),window.location.href=`/shell/${e}`;return}try{const n=await b(t,e);if(!n)throw new Error("No content");const r=document.getElementById("content");if(!r)throw new Error("No se encontró el contenedor #content");r.innerHTML=n,r.querySelectorAll('script[type="module"]').forEach(l=>{const o=document.createElement("script");o.type="module",l.src?o.src=l.src:o.textContent=l.textContent,document.body.appendChild(o)}),window.history.pushState({},"",t),L(),console.log(`[navigateTo] Ruta cargada dinámicamente: ${t}`),t==="/public/contact"&&E(()=>import("./contact.js"),[]).then(({setupContact:l})=>{l(),console.log("[navigateTo] setupContact activado")})}catch(n){console.error(`[navigateTo] Error: ${n.message}`),alert("Error al navegar a la ruta solicitada.")}}function $(t){return t.startsWith("/auth/")?"auth":t.startsWith("/private/")||t.startsWith("/admin/")?"private":"public"}async function b(t,s){const e=localStorage.getItem("jwt"),c=t.includes("?")?"&":"?",u=`${t}${c}fragment=1`;return s==="private"&&e?v(u).then(n=>n.ok?n.text():null):fetch(u).then(n=>n.ok?n.text():null)}export{$ as d,S as n,L as s};
