function Bn(i,e){i.terminate=function(){const t=()=>{};this.onerror=t,this.onmessage=t,this.onopen=t;const n=new Date,r=Math.random().toString().substring(2,8),s=this.onclose;this.onclose=o=>{const a=new Date().getTime()-n.getTime();e(`Discarded socket (#${r})  closed after ${a}ms, with code/reason: ${o.code}/${o.reason}`)},this.close(),s?.call(i,{code:4001,reason:`Quick discarding socket (#${r}) without waiting for the shutdown sequence.`,wasClean:!1})}}const V={LF:`
`,NULL:"\0"};class j{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(e){const{command:t,headers:n,body:r,binaryBody:s,escapeHeaderValues:o,skipContentLengthHeader:a}=e;this.command=t,this.headers=Object.assign({},n||{}),s?(this._binaryBody=s,this.isBinaryBody=!0):(this._body=r||"",this.isBinaryBody=!1),this.escapeHeaderValues=o||!1,this.skipContentLengthHeader=a||!1}static fromRawFrame(e,t){const n={},r=s=>s.replace(/^\s+|\s+$/g,"");for(const s of e.headers.reverse()){s.indexOf(":");const o=r(s[0]);let a=r(s[1]);t&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(a=j.hdrValueUnEscape(a)),n[o]=a}return new j({command:e.command,headers:n,binaryBody:e.binaryBody,escapeHeaderValues:t})}toString(){return this.serializeCmdAndHeaders()}serialize(){const e=this.serializeCmdAndHeaders();return this.isBinaryBody?j.toUnit8Array(e,this._binaryBody).buffer:e+this._body+V.NULL}serializeCmdAndHeaders(){const e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const t of Object.keys(this.headers||{})){const n=this.headers[t];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${t}:${j.hdrValueEscape(`${n}`)}`):e.push(`${t}:${n}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join(V.LF)+V.LF+V.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,t){const n=new TextEncoder().encode(e),r=new Uint8Array([0]),s=new Uint8Array(n.length+t.length+r.length);return s.set(n),s.set(t,n.length),s.set(r,n.length+t.length),s}static marshall(e){return new j(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const dt=0,Z=10,Y=13,Un=58;class Hn{constructor(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,t=!1){let n;if(typeof e=="string"?n=this._encoder.encode(e):n=new Uint8Array(e),t&&n[n.length-1]!==0){const r=new Uint8Array(n.length+1);r.set(n,0),r[n.length]=0,n=r}for(let r=0;r<n.length;r++){const s=n[r];this._onByte(s)}}_collectFrame(e){if(e!==dt&&e!==Y){if(e===Z){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==Y){if(e===Z){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==Y){if(e===Z){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===Un){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==Y){if(e===Z){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){const e=this._results.headers.filter(t=>t[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===dt){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var W;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSING=2]="CLOSING",i[i.CLOSED=3]="CLOSED"})(W||(W={}));var U;(function(i){i[i.ACTIVE=0]="ACTIVE",i[i.DEACTIVATING=1]="DEACTIVATING",i[i.INACTIVE=2]="INACTIVE"})(U||(U={}));var ie;(function(i){i[i.LINEAR=0]="LINEAR",i[i.EXPONENTIAL=1]="EXPONENTIAL"})(ie||(ie={}));var G;(function(i){i.Interval="interval",i.Worker="worker"})(G||(G={}));class jn{constructor(e,t=G.Interval,n){this._interval=e,this._strategy=t,this._debug=n,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(e){this.stop(),this.shouldUseWorker()?this.runWorker(e):this.runInterval(e)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===G.Worker}runWorker(e){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=t=>e(t.data))}runInterval(e){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const t=Date.now();this._timer=setInterval(()=>{e(Date.now()-t)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class A{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}}A.V1_0="1.0";A.V1_1="1.1";A.V1_2="1.2";A.default=new A([A.V1_2,A.V1_1,A.V1_0]);class Wn{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(e,t,n){this._client=e,this._webSocket=t,this._connected=!1,this._serverFrameHandlers={CONNECTED:r=>{this.debug(`connected to server ${r.headers.server}`),this._connected=!0,this._connectedVersion=r.headers.version,this._connectedVersion===A.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(r.headers),this.onConnect(r)},MESSAGE:r=>{const s=r.headers.subscription,o=this._subscriptions[s]||this.onUnhandledMessage,a=r,u=this,l=this._connectedVersion===A.V1_2?a.headers.ack:a.headers["message-id"];a.ack=(c={})=>u.ack(l,s,c),a.nack=(c={})=>u.nack(l,s,c),o(a)},RECEIPT:r=>{const s=this._receiptWatchers[r.headers["receipt-id"]];s?(s(r),delete this._receiptWatchers[r.headers["receipt-id"]]):this.onUnhandledReceipt(r)},ERROR:r=>{this.onStompError(r)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=n.debug,this.stompVersions=n.stompVersions,this.connectHeaders=n.connectHeaders,this.disconnectHeaders=n.disconnectHeaders,this.heartbeatIncoming=n.heartbeatIncoming,this.heartbeatOutgoing=n.heartbeatOutgoing,this.splitLargeFrames=n.splitLargeFrames,this.maxWebSocketChunkSize=n.maxWebSocketChunkSize,this.forceBinaryWSFrames=n.forceBinaryWSFrames,this.logRawCommunication=n.logRawCommunication,this.appendMissingNULLonIncoming=n.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=n.discardWebsocketOnCommFailure,this.onConnect=n.onConnect,this.onDisconnect=n.onDisconnect,this.onStompError=n.onStompError,this.onWebSocketClose=n.onWebSocketClose,this.onWebSocketError=n.onWebSocketError,this.onUnhandledMessage=n.onUnhandledMessage,this.onUnhandledReceipt=n.onUnhandledReceipt,this.onUnhandledFrame=n.onUnhandledFrame}start(){const e=new Hn(t=>{const n=j.fromRawFrame(t,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${n}`),(this._serverFrameHandlers[n.command]||this.onUnhandledFrame)(n)},()=>{this.debug("<<< PONG")});this._webSocket.onmessage=t=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const n=t.data instanceof ArrayBuffer?new TextDecoder().decode(t.data):t.data;this.debug(`<<< ${n}`)}e.parseChunk(t.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=t=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(t)},this._webSocket.onerror=t=>{this.onWebSocketError(t)},this._webSocket.onopen=()=>{const t=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),t["accept-version"]=this.stompVersions.supportedVersions(),t["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:t})}}_setupHeartbeat(e){if(e.version!==A.V1_1&&e.version!==A.V1_2||!e["heart-beat"])return;const[t,n]=e["heart-beat"].split(",").map(r=>parseInt(r,10));if(this.heartbeatOutgoing!==0&&n!==0){const r=Math.max(this.heartbeatOutgoing,n);this.debug(`send PING every ${r}ms`),this._pinger=new jn(r,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===W.OPEN&&(this._webSocket.send(V.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&t!==0){const r=Math.max(this.heartbeatIncoming,t);this.debug(`check PONG every ${r}ms`),this._ponger=setInterval(()=>{const s=Date.now()-this._lastServerActivityTS;s>r*2&&(this.debug(`did not receive server activity for the last ${s}ms`),this._closeOrDiscardWebsocket())},r)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===W.CONNECTING||this._webSocket.readyState===W.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Bn(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){const{command:t,headers:n,body:r,binaryBody:s,skipContentLengthHeader:o}=e,a=new j({command:t,headers:n,body:r,binaryBody:s,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:o});let u=a.serialize();if(this.logRawCommunication?this.debug(`>>> ${u}`):this.debug(`>>> ${a}`),this.forceBinaryWSFrames&&typeof u=="string"&&(u=new TextEncoder().encode(u)),typeof u!="string"||!this.splitLargeFrames)this._webSocket.send(u);else{let l=u;for(;l.length>0;){const c=l.substring(0,this.maxWebSocketChunkSize);l=l.substring(this.maxWebSocketChunkSize),this._webSocket.send(c),this.debug(`chunk sent = ${c.length}, remaining = ${l.length}`)}}}dispose(){if(this.connected)try{const e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,t=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===W.CONNECTING||this._webSocket.readyState===W.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){const{destination:t,headers:n,body:r,binaryBody:s,skipContentLengthHeader:o}=e,a=Object.assign({destination:t},n);this._transmit({command:"SEND",headers:a,body:r,binaryBody:s,skipContentLengthHeader:o})}watchForReceipt(e,t){this._receiptWatchers[e]=t}subscribe(e,t,n={}){n=Object.assign({},n),n.id||(n.id=`sub-${this._counter++}`),n.destination=e,this._subscriptions[n.id]=t,this._transmit({command:"SUBSCRIBE",headers:n});const r=this;return{id:n.id,unsubscribe(s){return r.unsubscribe(n.id,s)}}}unsubscribe(e,t={}){t=Object.assign({},t),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})}begin(e){const t=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:t}});const n=this;return{id:t,commit(){n.commit(t)},abort(){n.abort(t)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,t,n={}){n=Object.assign({},n),this._connectedVersion===A.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"ACK",headers:n})}nack(e,t,n={}){return n=Object.assign({},n),this._connectedVersion===A.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"NACK",headers:n})}}class Dn{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===U.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}constructor(e={}){this.stompVersions=A.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=ie.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=G.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=U.INACTIVE;const t=()=>{};this.debug=t,this.beforeConnect=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.onWebSocketError=t,this.logRawCommunication=!1,this.onChangeState=t,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}configure(e){Object.assign(this,e),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(U.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===U.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const e=this._createWebSocket();this._stompHandler=new Wn(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:t=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(t)},onDisconnect:t=>{this.onDisconnect(t)},onStompError:t=>{this.onStompError(t)},onWebSocketClose:t=>{this._stompHandler=void 0,this.state===U.DEACTIVATING&&this._changeState(U.INACTIVE),this.onWebSocketClose(t),this.active&&this._schedule_reconnect()},onWebSocketError:t=>{this.onWebSocketError(t)},onUnhandledMessage:t=>{this.onUnhandledMessage(t)},onUnhandledReceipt:t=>{this.onUnhandledReceipt(t)},onUnhandledFrame:t=>{this.onUnhandledFrame(t)}}),this._stompHandler.start()}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===ie.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(e={}){const t=e.force||!1,n=this.active;let r;if(this.state===U.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(U.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==W.CLOSED){const s=this._stompHandler.onWebSocketClose;r=new Promise((o,a)=>{this._stompHandler.onWebSocketClose=u=>{s(u),o()}})}else return this._changeState(U.INACTIVE),Promise.resolve();return t?this._stompHandler?.discardWebsocket():n&&this._disposeStompHandler(),r}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,t){this._checkConnection(),this._stompHandler.watchForReceipt(e,t)}subscribe(e,t,n={}){return this._checkConnection(),this._stompHandler.subscribe(e,t,n)}unsubscribe(e,t={}){this._checkConnection(),this._stompHandler.unsubscribe(e,t)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,t,n={}){this._checkConnection(),this._stompHandler.ack(e,t,n)}nack(e,t,n={}){this._checkConnection(),this._stompHandler.nack(e,t,n)}}var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ae={exports:{}},ee={},ft;function Fn(){return ft||(ft=1,b.crypto&&b.crypto.getRandomValues?ee.randomBytes=function(i){var e=new Uint8Array(i);return b.crypto.getRandomValues(e),e}:ee.randomBytes=function(i){for(var e=new Array(i),t=0;t<i;t++)e[t]=Math.floor(Math.random()*256);return e}),ee}var ce,pt;function $(){if(pt)return ce;pt=1;var i=Fn(),e="abcdefghijklmnopqrstuvwxyz012345";return ce={string:function(t){for(var n=e.length,r=i.randomBytes(t),s=[],o=0;o<t;o++)s.push(e.substr(r[o]%n,1));return s.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var n=(""+(t-1)).length,r=new Array(n+1).join("0");return(r+this.number(t)).slice(-n)}},ce}var mt;function P(){return mt||(mt=1,function(i){var e=$(),t={},n=!1,r=b.chrome&&b.chrome.app&&b.chrome.app.runtime;i.exports={attachEvent:function(o,a){typeof b.addEventListener<"u"?b.addEventListener(o,a,!1):b.document&&b.attachEvent&&(b.document.attachEvent("on"+o,a),b.attachEvent("on"+o,a))},detachEvent:function(o,a){typeof b.addEventListener<"u"?b.removeEventListener(o,a,!1):b.document&&b.detachEvent&&(b.document.detachEvent("on"+o,a),b.detachEvent("on"+o,a))},unloadAdd:function(o){if(r)return null;var a=e.string(8);return t[a]=o,n&&setTimeout(this.triggerUnloadCallbacks,0),a},unloadDel:function(o){o in t&&delete t[o]},triggerUnloadCallbacks:function(){for(var o in t)t[o](),delete t[o]}};var s=function(){n||(n=!0,i.exports.triggerUnloadCallbacks())};r||i.exports.attachEvent("unload",s)}(ae)),ae.exports}var ue,vt;function $n(){return vt||(vt=1,ue=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}),ue}var te={},gt;function Mn(){if(gt)return te;gt=1;var i=Object.prototype.hasOwnProperty,e;function t(o){try{return decodeURIComponent(o.replace(/\+/g," "))}catch{return null}}function n(o){try{return encodeURIComponent(o)}catch{return null}}function r(o){for(var a=/([^=?#&]+)=?([^&]*)/g,u={},l;l=a.exec(o);){var c=t(l[1]),p=t(l[2]);c===null||p===null||c in u||(u[c]=p)}return u}function s(o,a){a=a||"";var u=[],l,c;typeof a!="string"&&(a="?");for(c in o)if(i.call(o,c)){if(l=o[c],!l&&(l===null||l===e||isNaN(l))&&(l=""),c=n(c),l=n(l),c===null||l===null)continue;u.push(c+"="+l)}return u.length?a+u.join("&"):""}return te.stringify=s,te.parse=r,te}var le,bt;function Sn(){if(bt)return le;bt=1;var i=$n(),e=Mn(),t=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,n=/[\n\r\t]/g,r=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,s=/:\d+$/,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,a=/^[a-zA-Z]:/;function u(f){return(f||"").toString().replace(t,"")}var l=[["#","hash"],["?","query"],function(y,h){return v(h.protocol)?y.replace(/\\/g,"/"):y},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function p(f){var y;typeof window<"u"?y=window:typeof b<"u"?y=b:typeof self<"u"?y=self:y={};var h=y.location||{};f=f||h;var m={},E=typeof f,g;if(f.protocol==="blob:")m=new x(unescape(f.pathname),{});else if(E==="string"){m=new x(f,{});for(g in c)delete m[g]}else if(E==="object"){for(g in f)g in c||(m[g]=f[g]);m.slashes===void 0&&(m.slashes=r.test(f.href))}return m}function v(f){return f==="file:"||f==="ftp:"||f==="http:"||f==="https:"||f==="ws:"||f==="wss:"}function S(f,y){f=u(f),f=f.replace(n,""),y=y||{};var h=o.exec(f),m=h[1]?h[1].toLowerCase():"",E=!!h[2],g=!!h[3],d=0,_;return E?g?(_=h[2]+h[3]+h[4],d=h[2].length+h[3].length):(_=h[2]+h[4],d=h[2].length):g?(_=h[3]+h[4],d=h[3].length):_=h[4],m==="file:"?d>=2&&(_=_.slice(2)):v(m)?_=h[4]:m?E&&(_=_.slice(2)):d>=2&&v(y.protocol)&&(_=h[4]),{protocol:m,slashes:E||v(m),slashesCount:d,rest:_}}function R(f,y){if(f==="")return y;for(var h=(y||"/").split("/").slice(0,-1).concat(f.split("/")),m=h.length,E=h[m-1],g=!1,d=0;m--;)h[m]==="."?h.splice(m,1):h[m]===".."?(h.splice(m,1),d++):d&&(m===0&&(g=!0),h.splice(m,1),d--);return g&&h.unshift(""),(E==="."||E==="..")&&h.push(""),h.join("/")}function x(f,y,h){if(f=u(f),f=f.replace(n,""),!(this instanceof x))return new x(f,y,h);var m,E,g,d,_,C,I=l.slice(),N=typeof y,w=this,H=0;for(N!=="object"&&N!=="string"&&(h=y,y=null),h&&typeof h!="function"&&(h=e.parse),y=p(y),E=S(f||"",y),m=!E.protocol&&!E.slashes,w.slashes=E.slashes||m&&y.slashes,w.protocol=E.protocol||y.protocol||"",f=E.rest,(E.protocol==="file:"&&(E.slashesCount!==2||a.test(f))||!E.slashes&&(E.protocol||E.slashesCount<2||!v(w.protocol)))&&(I[3]=[/(.*)/,"pathname"]);H<I.length;H++){if(d=I[H],typeof d=="function"){f=d(f,w);continue}g=d[0],C=d[1],g!==g?w[C]=f:typeof g=="string"?(_=g==="@"?f.lastIndexOf(g):f.indexOf(g),~_&&(typeof d[2]=="number"?(w[C]=f.slice(0,_),f=f.slice(_+d[2])):(w[C]=f.slice(_),f=f.slice(0,_)))):(_=g.exec(f))&&(w[C]=_[1],f=f.slice(0,_.index)),w[C]=w[C]||m&&d[3]&&y[C]||"",d[4]&&(w[C]=w[C].toLowerCase())}h&&(w.query=h(w.query)),m&&y.slashes&&w.pathname.charAt(0)!=="/"&&(w.pathname!==""||y.pathname!=="")&&(w.pathname=R(w.pathname,y.pathname)),w.pathname.charAt(0)!=="/"&&v(w.protocol)&&(w.pathname="/"+w.pathname),i(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(_=w.auth.indexOf(":"),~_?(w.username=w.auth.slice(0,_),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(_+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin=w.protocol!=="file:"&&v(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}function k(f,y,h){var m=this;switch(f){case"query":typeof y=="string"&&y.length&&(y=(h||e.parse)(y)),m[f]=y;break;case"port":m[f]=y,i(y,m.protocol)?y&&(m.host=m.hostname+":"+y):(m.host=m.hostname,m[f]="");break;case"hostname":m[f]=y,m.port&&(y+=":"+m.port),m.host=y;break;case"host":m[f]=y,s.test(y)?(y=y.split(":"),m.port=y.pop(),m.hostname=y.join(":")):(m.hostname=y,m.port="");break;case"protocol":m.protocol=y.toLowerCase(),m.slashes=!h;break;case"pathname":case"hash":if(y){var E=f==="pathname"?"/":"#";m[f]=y.charAt(0)!==E?E+y:y}else m[f]=y;break;case"username":case"password":m[f]=encodeURIComponent(y);break;case"auth":var g=y.indexOf(":");~g?(m.username=y.slice(0,g),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=y.slice(g+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(y))}for(var d=0;d<l.length;d++){var _=l[d];_[4]&&(m[_[1]]=m[_[1]].toLowerCase())}return m.auth=m.password?m.username+":"+m.password:m.username,m.origin=m.protocol!=="file:"&&v(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString(),m}function O(f){(!f||typeof f!="function")&&(f=e.stringify);var y,h=this,m=h.host,E=h.protocol;E&&E.charAt(E.length-1)!==":"&&(E+=":");var g=E+(h.protocol&&h.slashes||v(h.protocol)?"//":"");return h.username?(g+=h.username,h.password&&(g+=":"+h.password),g+="@"):h.password?(g+=":"+h.password,g+="@"):h.protocol!=="file:"&&v(h.protocol)&&!m&&h.pathname!=="/"&&(g+="@"),(m[m.length-1]===":"||s.test(h.hostname)&&!h.port)&&(m+=":"),g+=m+h.pathname,y=typeof h.query=="object"?f(h.query):h.query,y&&(g+=y.charAt(0)!=="?"?"?"+y:y),h.hash&&(g+=h.hash),g}return x.prototype={set:k,toString:O},x.extractProtocol=S,x.location=p,x.trimLeft=u,x.qs=e,le=x,le}var he,yt;function B(){if(yt)return he;yt=1;var i=Sn();return he={getOrigin:function(e){if(!e)return null;var t=new i(e);if(t.protocol==="file:")return null;var n=t.port;return n||(n=t.protocol==="https:"?"443":"80"),t.protocol+"//"+t.hostname+":"+n},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(e.indexOf("?")===-1?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}},he}var ne={exports:{}},_t;function T(){return _t||(_t=1,typeof Object.create=="function"?ne.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:ne.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),ne.exports}var de={},fe,wt;function Cn(){if(wt)return fe;wt=1;function i(){this._listeners={}}return i.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];n.indexOf(t)===-1&&(n=n.concat([t])),this._listeners[e]=n},i.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);if(r!==-1){n.length>1?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e];return}}},i.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=arguments.length===1?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var r=this._listeners[t],s=0;s<r.length;s++)r[s].apply(this,n)},fe=i,fe}var Et;function L(){if(Et)return de;Et=1;var i=T(),e=Cn();function t(){e.call(this)}return i(t,e),t.prototype.removeAllListeners=function(n){n?delete this._listeners[n]:this._listeners={}},t.prototype.once=function(n,r){var s=this,o=!1;function a(){s.removeListener(n,a),o||(o=!0,r.apply(this,arguments))}this.on(n,a)},t.prototype.emit=function(){var n=arguments[0],r=this._listeners[n];if(r){for(var s=arguments.length,o=new Array(s-1),a=1;a<s;a++)o[a-1]=arguments[a];for(var u=0;u<r.length;u++)r[u].apply(this,o)}},t.prototype.on=t.prototype.addListener=e.prototype.addEventListener,t.prototype.removeListener=e.prototype.removeEventListener,de.EventEmitter=t,de}var re={exports:{}},St;function Vn(){if(St)return re.exports;St=1;var i=b.WebSocket||b.MozWebSocket;return i?re.exports=function(t){return new i(t)}:re.exports=void 0,re.exports}var pe,Ct;function Xn(){if(Ct)return pe;Ct=1;var i=P(),e=B(),t=T(),n=L().EventEmitter,r=Vn(),s=function(){};function o(a,u,l){if(!o.enabled())throw new Error("Transport created when disabled");n.call(this);var c=this,p=e.addPath(a,"/websocket");p.slice(0,5)==="https"?p="wss"+p.slice(5):p="ws"+p.slice(4),this.url=p,this.ws=new r(this.url,[],l),this.ws.onmessage=function(v){s("message event",v.data),c.emit("message",v.data)},this.unloadRef=i.unloadAdd(function(){c.ws.close()}),this.ws.onclose=function(v){s("close event",v.code,v.reason),c.emit("close",v.code,v.reason),c._cleanup()},this.ws.onerror=function(v){c.emit("close",1006,"WebSocket connection broken"),c._cleanup()}}return t(o,n),o.prototype.send=function(a){var u="["+a+"]";this.ws.send(u)},o.prototype.close=function(){var a=this.ws;this._cleanup(),a&&a.close()},o.prototype._cleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=a.onerror=null),i.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},o.enabled=function(){return!!r},o.transportName="websocket",o.roundTrips=2,pe=o,pe}var me,xt;function Gn(){if(xt)return me;xt=1;var i=T(),e=L().EventEmitter,t=function(){};function n(r,s){e.call(this),this.sendBuffer=[],this.sender=s,this.url=r}return i(n,e),n.prototype.send=function(r){this.sendBuffer.push(r),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var r=this,s;this.sendStop=function(){r.sendStop=null,clearTimeout(s)},s=setTimeout(function(){r.sendStop=null,r.sendSchedule()},25)},n.prototype.sendSchedule=function(){t("sendSchedule",this.sendBuffer.length);var r=this;if(this.sendBuffer.length>0){var s="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,s,function(o){r.sendStop=null,o?(r.emit("close",o.code||1006,"Sending error: "+o),r.close()):r.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},me=n,me}var ve,kt;function Jn(){if(kt)return ve;kt=1;var i=T(),e=L().EventEmitter,t=function(){};function n(r,s,o){e.call(this),this.Receiver=r,this.receiveUrl=s,this.AjaxObject=o,this._scheduleReceiver()}return i(n,e),n.prototype._scheduleReceiver=function(){var r=this,s=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);s.on("message",function(o){r.emit("message",o)}),s.once("close",function(o,a){t("close",o,a,r.pollIsClosing),r.poll=s=null,r.pollIsClosing||(a==="network"?r._scheduleReceiver():(r.emit("close",o||1006,a),r.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},ve=n,ve}var ge,It;function xn(){if(It)return ge;It=1;var i=T(),e=B(),t=Gn(),n=Jn();function r(s,o,a,u,l){var c=e.addPath(s,o),p=this;t.call(this,s,a),this.poll=new n(u,c,l),this.poll.on("message",function(v){p.emit("message",v)}),this.poll.once("close",function(v,S){p.poll=null,p.emit("close",v,S),p.close()})}return i(r,t),r.prototype.close=function(){t.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},ge=r,ge}var be,Tt;function M(){if(Tt)return be;Tt=1;var i=T(),e=B(),t=xn();function n(s){return function(o,a,u){var l={};typeof a=="string"&&(l.headers={"Content-type":"text/plain"});var c=e.addPath(o,"/xhr_send"),p=new s("POST",c,a,l);return p.once("finish",function(v){if(p=null,v!==200&&v!==204)return u(new Error("http status "+v));u()}),function(){p.close(),p=null;var v=new Error("Aborted");v.code=1e3,u(v)}}}function r(s,o,a,u){t.call(this,s,o,n(u),a,u)}return i(r,t),be=r,be}var ye,Rt;function se(){if(Rt)return ye;Rt=1;var i=T(),e=L().EventEmitter;function t(n,r){e.call(this);var s=this;this.bufferPosition=0,this.xo=new r("POST",n,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(o,a){s._chunkHandler(o,a),s.xo=null;var u=o===200?"network":"permanent";s.emit("close",null,u),s._cleanup()})}return i(t,e),t.prototype._chunkHandler=function(n,r){if(!(n!==200||!r))for(var s=-1;;this.bufferPosition+=s+1){var o=r.slice(this.bufferPosition);if(s=o.indexOf(`
`),s===-1)break;var a=o.slice(0,s);a&&this.emit("message",a)}},t.prototype._cleanup=function(){this.removeAllListeners()},t.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},ye=t,ye}var _e,Ot;function kn(){if(Ot)return _e;Ot=1;var i=L().EventEmitter,e=T(),t=P(),n=B(),r=b.XMLHttpRequest,s=function(){};function o(l,c,p,v){var S=this;i.call(this),setTimeout(function(){S._start(l,c,p,v)},0)}e(o,i),o.prototype._start=function(l,c,p,v){var S=this;try{this.xhr=new r}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}c=n.addQuery(c,"t="+ +new Date),this.unloadRef=t.unloadAdd(function(){S._cleanup(!0)});try{this.xhr.open(l,c,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){s("xhr timeout"),S.emit("finish",0,""),S._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!v||!v.noCredentials)&&o.supportsCORS&&(this.xhr.withCredentials=!0),v&&v.headers)for(var R in v.headers)this.xhr.setRequestHeader(R,v.headers[R]);this.xhr.onreadystatechange=function(){if(S.xhr){var x=S.xhr,k,O;switch(s("readyState",x.readyState),x.readyState){case 3:try{O=x.status,k=x.responseText}catch{}O===1223&&(O=204),O===200&&k&&k.length>0&&S.emit("chunk",O,k);break;case 4:O=x.status,O===1223&&(O=204),(O===12005||O===12029)&&(O=0),s("finish",O,x.responseText),S.emit("finish",O,x.responseText),S._cleanup(!1);break}}};try{S.xhr.send(p)}catch{S.emit("finish",0,""),S._cleanup(!1)}},o.prototype._cleanup=function(l){if(this.xhr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),l)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!r;var a=["Active"].concat("Object").join("X");!o.enabled&&a in b&&(r=function(){try{return new b[a]("Microsoft.XMLHTTP")}catch{return null}},o.enabled=!!new r);var u=!1;try{u="withCredentials"in new r}catch{}return o.supportsCORS=u,_e=o,_e}var we,Nt;function oe(){if(Nt)return we;Nt=1;var i=T(),e=kn();function t(n,r,s,o){e.call(this,n,r,s,o)}return i(t,e),t.enabled=e.enabled&&e.supportsCORS,we=t,we}var Ee,qt;function J(){if(qt)return Ee;qt=1;var i=T(),e=kn();function t(n,r,s){e.call(this,n,r,s,{noCredentials:!0})}return i(t,e),t.enabled=e.enabled,Ee=t,Ee}var Se,At;function z(){return At||(At=1,Se={isOpera:function(){return b.navigator&&/opera/i.test(b.navigator.userAgent)},isKonqueror:function(){return b.navigator&&/konqueror/i.test(b.navigator.userAgent)},hasDomain:function(){if(!b.document)return!0;try{return!!b.document.domain}catch{return!1}}}),Se}var Ce,Lt;function zn(){if(Lt)return Ce;Lt=1;var i=T(),e=M(),t=se(),n=oe(),r=J(),s=z();function o(a){if(!r.enabled&&!n.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr_streaming",t,n)}return i(o,e),o.enabled=function(a){return a.nullOrigin||s.isOpera()?!1:n.enabled},o.transportName="xhr-streaming",o.roundTrips=2,o.needBody=!!b.document,Ce=o,Ce}var xe,Bt;function at(){if(Bt)return xe;Bt=1;var i=L().EventEmitter,e=T(),t=P(),n=z(),r=B(),s=function(){};function o(a,u,l){var c=this;i.call(this),setTimeout(function(){c._start(a,u,l)},0)}return e(o,i),o.prototype._start=function(a,u,l){var c=this,p=new b.XDomainRequest;u=r.addQuery(u,"t="+ +new Date),p.onerror=function(){c._error()},p.ontimeout=function(){c._error()},p.onprogress=function(){s("progress",p.responseText),c.emit("chunk",200,p.responseText)},p.onload=function(){c.emit("finish",200,p.responseText),c._cleanup(!1)},this.xdr=p,this.unloadRef=t.unloadAdd(function(){c._cleanup(!0)});try{this.xdr.open(a,u),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(l)}catch{this._error()}},o.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},o.prototype._cleanup=function(a){if(this.xdr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,a)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!(b.XDomainRequest&&n.hasDomain()),xe=o,xe}var ke,Ut;function In(){if(Ut)return ke;Ut=1;var i=T(),e=M(),t=se(),n=at();function r(s){if(!n.enabled)throw new Error("Transport created when disabled");e.call(this,s,"/xhr_streaming",t,n)}return i(r,e),r.enabled=function(s){return s.cookie_needed||s.nullOrigin?!1:n.enabled&&s.sameScheme},r.transportName="xdr-streaming",r.roundTrips=2,ke=r,ke}var Ie,Ht;function Tn(){return Ht||(Ht=1,Ie=b.EventSource),Ie}var Te,jt;function Kn(){if(jt)return Te;jt=1;var i=T(),e=L().EventEmitter,t=Tn(),n=function(){};function r(s){e.call(this);var o=this,a=this.es=new t(s);a.onmessage=function(u){n("message",u.data),o.emit("message",decodeURI(u.data))},a.onerror=function(u){n("error",a.readyState);var l=a.readyState!==2?"network":"permanent";o._cleanup(),o._close(l)}}return i(r,e),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){var s=this.es;s&&(s.onmessage=s.onerror=null,s.close(),this.es=null)},r.prototype._close=function(s){var o=this;setTimeout(function(){o.emit("close",null,s),o.removeAllListeners()},200)},Te=r,Te}var Re,Wt;function Dt(){if(Wt)return Re;Wt=1;var i=T(),e=M(),t=Kn(),n=oe(),r=Tn();function s(o){if(!s.enabled())throw new Error("Transport created when disabled");e.call(this,o,"/eventsource",t,n)}return i(s,e),s.enabled=function(){return!!r},s.transportName="eventsource",s.roundTrips=2,Re=s,Re}var Oe,Pt;function Rn(){return Pt||(Pt=1,Oe="1.6.1"),Oe}var Ne={exports:{}},Ft;function K(){return Ft||(Ft=1,function(i){var e=P(),t=z();i.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){i.exports.WPrefix in b||(b[i.exports.WPrefix]={})},postMessage:function(n,r){b.parent!==b&&b.parent.postMessage(JSON.stringify({windowId:i.exports.currentWindowId,type:n,data:r||""}),"*")},createIframe:function(n,r){var s=b.document.createElement("iframe"),o,a,u=function(){clearTimeout(o);try{s.onload=null}catch{}s.onerror=null},l=function(){s&&(u(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),e.unloadDel(a))},c=function(v){s&&(l(),r(v))},p=function(v,S){setTimeout(function(){try{s&&s.contentWindow&&s.contentWindow.postMessage(v,S)}catch{}},0)};return s.src=n,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(o),o=setTimeout(function(){c("onload timeout")},2e3)},b.document.body.appendChild(s),o=setTimeout(function(){c("timeout")},15e3),a=e.unloadAdd(l),{post:p,cleanup:l,loaded:u}},createHtmlfile:function(n,r){var s=["Active"].concat("Object").join("X"),o=new b[s]("htmlfile"),a,u,l,c=function(){clearTimeout(a),l.onerror=null},p=function(){o&&(c(),e.unloadDel(u),l.parentNode.removeChild(l),l=o=null,CollectGarbage())},v=function(x){o&&(p(),r(x))},S=function(x,k){try{setTimeout(function(){l&&l.contentWindow&&l.contentWindow.postMessage(x,k)},0)}catch{}};o.open(),o.write('<html><script>document.domain="'+b.document.domain+'";<\/script></html>'),o.close(),o.parentWindow[i.exports.WPrefix]=b[i.exports.WPrefix];var R=o.createElement("div");return o.body.appendChild(R),l=o.createElement("iframe"),R.appendChild(l),l.src=n,l.onerror=function(){v("onerror")},a=setTimeout(function(){v("timeout")},15e3),u=e.unloadAdd(p),{post:S,cleanup:p,loaded:c}}},i.exports.iframeEnabled=!1,b.document&&(i.exports.iframeEnabled=(typeof b.postMessage=="function"||typeof b.postMessage=="object")&&!t.isKonqueror())}(Ne)),Ne.exports}var qe,$t;function On(){if($t)return qe;$t=1;var i=T(),e=L().EventEmitter,t=Rn(),n=B(),r=K(),s=P(),o=$(),a=function(){};function u(l,c,p){if(!u.enabled())throw new Error("Transport created when disabled");e.call(this);var v=this;this.origin=n.getOrigin(p),this.baseUrl=p,this.transUrl=c,this.transport=l,this.windowId=o.string(8);var S=n.addPath(p,"/iframe.html")+"#"+this.windowId;this.iframeObj=r.createIframe(S,function(R){v.emit("close",1006,"Unable to load an iframe ("+R+")"),v.close()}),this.onmessageCallback=this._message.bind(this),s.attachEvent("message",this.onmessageCallback)}return i(u,e),u.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){s.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},u.prototype._message=function(l){if(a("message",l.data),!n.isOriginEqual(l.origin,this.origin)){a("not same origin",l.origin,this.origin);return}var c;try{c=JSON.parse(l.data)}catch{a("bad json",l.data);return}if(c.windowId!==this.windowId){a("mismatched window id",c.windowId,this.windowId);return}switch(c.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([t,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",c.data);break;case"c":var p;try{p=JSON.parse(c.data)}catch{a("bad json",c.data);return}this.emit("close",p[0],p[1]),this.close();break}},u.prototype.postMessage=function(l,c){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:l,data:c||""}),this.origin)},u.prototype.send=function(l){this.postMessage("m",l)},u.enabled=function(){return r.iframeEnabled},u.transportName="iframe",u.roundTrips=2,qe=u,qe}var Ae,Mt;function ct(){return Mt||(Mt=1,Ae={isObject:function(i){var e=typeof i;return e==="function"||e==="object"&&!!i},extend:function(i){if(!this.isObject(i))return i;for(var e,t,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i}}),Ae}var Le,Vt;function Be(){if(Vt)return Le;Vt=1;var i=T(),e=On(),t=ct();return Le=function(n){function r(s,o){e.call(this,n.transportName,s,o)}return i(r,e),r.enabled=function(s,o){if(!b.document)return!1;var a=t.extend({},o);return a.sameOrigin=!0,n.enabled(a)&&e.enabled()},r.transportName="iframe-"+n.transportName,r.needBody=!0,r.roundTrips=e.roundTrips+n.roundTrips-1,r.facadeTransport=n,r},Le}var Ue,Xt;function Qn(){if(Xt)return Ue;Xt=1;var i=T(),e=K(),t=B(),n=L().EventEmitter,r=$(),s=function(){};function o(u){n.call(this);var l=this;e.polluteGlobalNamespace(),this.id="a"+r.string(6),u=t.addQuery(u,"c="+decodeURIComponent(e.WPrefix+"."+this.id)),s("using htmlfile",o.htmlfileEnabled);var c=o.htmlfileEnabled?e.createHtmlfile:e.createIframe;b[e.WPrefix][this.id]={start:function(){l.iframeObj.loaded()},message:function(p){l.emit("message",p)},stop:function(){l._cleanup(),l._close("network")}},this.iframeObj=c(u,function(){l._cleanup(),l._close("permanent")})}i(o,n),o.prototype.abort=function(){this._cleanup(),this._close("user")},o.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete b[e.WPrefix][this.id]},o.prototype._close=function(u){this.emit("close",null,u),this.removeAllListeners()},o.htmlfileEnabled=!1;var a=["Active"].concat("Object").join("X");if(a in b)try{o.htmlfileEnabled=!!new b[a]("htmlfile")}catch{}return o.enabled=o.htmlfileEnabled||e.iframeEnabled,Ue=o,Ue}var He,Gt;function Jt(){if(Gt)return He;Gt=1;var i=T(),e=Qn(),t=J(),n=M();function r(s){if(!e.enabled)throw new Error("Transport created when disabled");n.call(this,s,"/htmlfile",e,t)}return i(r,n),r.enabled=function(s){return e.enabled&&s.sameOrigin},r.transportName="htmlfile",r.roundTrips=2,He=r,He}var je,zt;function Kt(){if(zt)return je;zt=1;var i=T(),e=M(),t=se(),n=oe(),r=J();function s(o){if(!r.enabled&&!n.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",t,n)}return i(s,e),s.enabled=function(o){return o.nullOrigin?!1:r.enabled&&o.sameOrigin?!0:n.enabled},s.transportName="xhr-polling",s.roundTrips=2,je=s,je}var We,Qt;function Zn(){if(Qt)return We;Qt=1;var i=T(),e=M(),t=In(),n=se(),r=at();function s(o){if(!r.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",n,r)}return i(s,e),s.enabled=t.enabled,s.transportName="xdr-polling",s.roundTrips=2,We=s,We}var De,Zt;function Yn(){if(Zt)return De;Zt=1;var i=K(),e=$(),t=z(),n=B(),r=T(),s=L().EventEmitter,o=function(){};function a(u){var l=this;s.call(this),i.polluteGlobalNamespace(),this.id="a"+e.string(6);var c=n.addQuery(u,"c="+encodeURIComponent(i.WPrefix+"."+this.id));b[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(c),this.timeoutId=setTimeout(function(){l._abort(new Error("JSONP script loaded abnormally (timeout)"))},a.timeout)}return r(a,s),a.prototype.abort=function(){if(b[i.WPrefix][this.id]){var u=new Error("JSONP user aborted read");u.code=1e3,this._abort(u)}},a.timeout=35e3,a.scriptErrorTimeout=1e3,a.prototype._callback=function(u){this._cleanup(),!this.aborting&&(u&&this.emit("message",u),this.emit("close",null,"network"),this.removeAllListeners())},a.prototype._abort=function(u){this._cleanup(),this.aborting=!0,this.emit("close",u.code,u.message),this.removeAllListeners()},a.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var u=this.script;u.parentNode.removeChild(u),u.onreadystatechange=u.onerror=u.onload=u.onclick=null,this.script=null}delete b[i.WPrefix][this.id]},a.prototype._scriptError=function(){var u=this;this.errorTimer||(this.errorTimer=setTimeout(function(){u.loadedOkay||u._abort(new Error("JSONP script loaded abnormally (onerror)"))},a.scriptErrorTimeout))},a.prototype._createScript=function(u){var l=this,c=this.script=b.document.createElement("script"),p;if(c.id="a"+e.string(8),c.src=u,c.type="text/javascript",c.charset="UTF-8",c.onerror=this._scriptError.bind(this),c.onload=function(){l._abort(new Error("JSONP script loaded abnormally (onload)"))},c.onreadystatechange=function(){if(o("onreadystatechange",c.readyState),/loaded|closed/.test(c.readyState)){if(c&&c.htmlFor&&c.onclick){l.loadedOkay=!0;try{c.onclick()}catch{}}c&&l._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof c.async>"u"&&b.document.attachEvent)if(t.isOpera())p=this.script2=b.document.createElement("script"),p.text="try{var a = document.getElementById('"+c.id+"'); if(a)a.onerror();}catch(x){};",c.async=p.async=!1;else{try{c.htmlFor=c.id,c.event="onclick"}catch{}c.async=!0}typeof c.async<"u"&&(c.async=!0);var v=b.document.getElementsByTagName("head")[0];v.insertBefore(c,v.firstChild),p&&v.insertBefore(p,v.firstChild)},De=a,De}var Pe,Yt;function er(){if(Yt)return Pe;Yt=1;var i=$(),e=B(),t=function(){},n,r;function s(a){try{return b.document.createElement('<iframe name="'+a+'">')}catch{var u=b.document.createElement("iframe");return u.name=a,u}}function o(){n=b.document.createElement("form"),n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",r=b.document.createElement("textarea"),r.name="d",n.appendChild(r),b.document.body.appendChild(n)}return Pe=function(a,u,l){n||o();var c="a"+i.string(8);n.target=c,n.action=e.addQuery(e.addPath(a,"/jsonp_send"),"i="+c);var p=s(c);p.id=c,p.style.display="none",n.appendChild(p);try{r.value=u}catch{}n.submit();var v=function(S){p.onerror&&(p.onreadystatechange=p.onerror=p.onload=null,setTimeout(function(){p.parentNode.removeChild(p),p=null},500),r.value="",l(S))};return p.onerror=function(){v()},p.onload=function(){v()},p.onreadystatechange=function(S){t("onreadystatechange",c,p.readyState),p.readyState==="complete"&&v()},function(){v(new Error("Aborted"))}},Pe}var Fe,en;function tr(){if(en)return Fe;en=1;var i=T(),e=xn(),t=Yn(),n=er();function r(s){if(!r.enabled())throw new Error("Transport created when disabled");e.call(this,s,"/jsonp",n,t)}return i(r,e),r.enabled=function(){return!!b.document},r.transportName="jsonp-polling",r.roundTrips=1,r.needBody=!0,Fe=r,Fe}var $e,tn;function nr(){return tn||(tn=1,$e=[Xn(),zn(),In(),Dt(),Be()(Dt()),Jt(),Be()(Jt()),Kt(),Zn(),Be()(Kt()),tr()]),$e}var nn={},rn;function rr(){if(rn)return nn;rn=1;var i=Array.prototype,e=Object.prototype,t=Function.prototype,n=String.prototype,r=i.slice,s=e.toString,o=function(g){return e.toString.call(g)==="[object Function]"},a=function(d){return s.call(d)==="[object Array]"},u=function(d){return s.call(d)==="[object String]"},l=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),c;l?c=function(g,d,_,C){!C&&d in g||Object.defineProperty(g,d,{configurable:!0,enumerable:!1,writable:!0,value:_})}:c=function(g,d,_,C){!C&&d in g||(g[d]=_)};var p=function(g,d,_){for(var C in d)e.hasOwnProperty.call(d,C)&&c(g,C,d[C],_)},v=function(g){if(g==null)throw new TypeError("can't convert "+g+" to object");return Object(g)};function S(g){var d=+g;return d!==d?d=0:d!==0&&d!==1/0&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d))),d}function R(g){return g>>>0}function x(){}p(t,{bind:function(d){var _=this;if(!o(_))throw new TypeError("Function.prototype.bind called on incompatible "+_);for(var C=r.call(arguments,1),I=function(){if(this instanceof q){var F=_.apply(this,C.concat(r.call(arguments)));return Object(F)===F?F:this}else return _.apply(d,C.concat(r.call(arguments)))},N=Math.max(0,_.length-C.length),w=[],H=0;H<N;H++)w.push("$"+H);var q=Function("binder","return function ("+w.join(",")+"){ return binder.apply(this, arguments); }")(I);return _.prototype&&(x.prototype=_.prototype,q.prototype=new x,x.prototype=null),q}}),p(Array,{isArray:a});var k=Object("a"),O=k[0]!=="a"||!(0 in k),f=function(d){var _=!0,C=!0;return d&&(d.call("foo",function(I,N,w){typeof w!="object"&&(_=!1)}),d.call([1],function(){C=typeof this=="string"},"x")),!!d&&_&&C};p(i,{forEach:function(d){var _=v(this),C=O&&u(this)?this.split(""):_,I=arguments[1],N=-1,w=C.length>>>0;if(!o(d))throw new TypeError;for(;++N<w;)N in C&&d.call(I,C[N],N,_)}},!f(i.forEach));var y=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;p(i,{indexOf:function(d){var _=O&&u(this)?this.split(""):v(this),C=_.length>>>0;if(!C)return-1;var I=0;for(arguments.length>1&&(I=S(arguments[1])),I=I>=0?I:Math.max(0,C+I);I<C;I++)if(I in _&&_[I]===d)return I;return-1}},y);var h=n.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var g=/()??/.exec("")[1]===void 0;n.split=function(d,_){var C=this;if(d===void 0&&_===0)return[];if(s.call(d)!=="[object RegExp]")return h.call(this,d,_);var I=[],N=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.extended?"x":"")+(d.sticky?"y":""),w=0,H,q,F,ht;for(d=new RegExp(d.source,N+"g"),C+="",g||(H=new RegExp("^"+d.source+"$(?!\\s)",N)),_=_===void 0?-1>>>0:R(_);(q=d.exec(C))&&(F=q.index+q[0].length,!(F>w&&(I.push(C.slice(w,q.index)),!g&&q.length>1&&q[0].replace(H,function(){for(var Q=1;Q<arguments.length-2;Q++)arguments[Q]===void 0&&(q[Q]=void 0)}),q.length>1&&q.index<C.length&&i.push.apply(I,q.slice(1)),ht=q[0].length,w=F,I.length>=_)));)d.lastIndex===q.index&&d.lastIndex++;return w===C.length?(ht||!d.test(""))&&I.push(""):I.push(C.slice(w)),I.length>_?I.slice(0,_):I}}():"0".split(void 0,0).length&&(n.split=function(d,_){return d===void 0&&_===0?[]:h.call(this,d,_)});var m=n.substr,E="".substr&&"0b".substr(-1)!=="b";return p(n,{substr:function(d,_){return m.call(this,d<0&&(d=this.length+d)<0?0:d,_)}},E),nn}var Me,sn;function ir(){if(sn)return Me;sn=1;var i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,e,t=function(n){var r,s={},o=[];for(r=0;r<65536;r++)o.push(String.fromCharCode(r));return n.lastIndex=0,o.join("").replace(n,function(a){return s[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),n.lastIndex=0,s};return Me={quote:function(n){var r=JSON.stringify(n);return i.lastIndex=0,i.test(r)?(e||(e=t(i)),r.replace(i,function(s){return e[s]})):r}},Me}var Ve,on;function sr(){if(on)return Ve;on=1;var i=function(){};return Ve=function(e){return{filterToEnabled:function(t,n){var r={main:[],facade:[]};return t?typeof t=="string"&&(t=[t]):t=[],e.forEach(function(s){if(s&&!(s.transportName==="websocket"&&n.websocket===!1)){if(t.length&&t.indexOf(s.transportName)===-1){i("not in whitelist",s.transportName);return}s.enabled(n)?(i("enabled",s.transportName),r.main.push(s),s.facadeTransport&&r.facade.push(s.facadeTransport)):i("disabled",s.transportName)}}),r}}},Ve}var Xe,an;function or(){if(an)return Xe;an=1;var i={};return["log","debug","warn"].forEach(function(e){var t;try{t=b.console&&b.console[e]&&b.console[e].apply}catch{}i[e]=t?function(){return b.console[e].apply(b.console,arguments)}:e==="log"?function(){}:i.log}),Xe=i,Xe}var Ge,cn;function ut(){if(cn)return Ge;cn=1;function i(e){this.type=e}return i.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},i.prototype.stopPropagation=function(){},i.prototype.preventDefault=function(){},i.CAPTURING_PHASE=1,i.AT_TARGET=2,i.BUBBLING_PHASE=3,Ge=i,Ge}var Je,un;function Nn(){return un||(un=1,Je=b.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),Je}var ze,ln;function ar(){if(ln)return ze;ln=1;var i=T(),e=ut();function t(){e.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return i(t,e),ze=t,ze}var Ke,hn;function cr(){if(hn)return Ke;hn=1;var i=T(),e=ut();function t(n){e.call(this),this.initEvent("message",!1,!1),this.data=n}return i(t,e),Ke=t,Ke}var Qe,dn;function ur(){if(dn)return Qe;dn=1;var i=L().EventEmitter,e=T();function t(){var n=this;i.call(this),this.to=setTimeout(function(){n.emit("finish",200,"{}")},t.timeout)}return e(t,i),t.prototype.close=function(){clearTimeout(this.to)},t.timeout=2e3,Qe=t,Qe}var Ze,fn;function qn(){if(fn)return Ze;fn=1;var i=L().EventEmitter,e=T(),t=ct();function n(r,s){i.call(this);var o=this,a=+new Date;this.xo=new s("GET",r),this.xo.once("finish",function(u,l){var c,p;if(u===200){if(p=+new Date-a,l)try{c=JSON.parse(l)}catch{}t.isObject(c)||(c={})}o.emit("finish",c,p),o.removeAllListeners()})}return e(n,i),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},Ze=n,Ze}var Ye,pn;function An(){if(pn)return Ye;pn=1;var i=T(),e=L().EventEmitter,t=J(),n=qn();function r(s){var o=this;e.call(this),this.ir=new n(s,t),this.ir.once("finish",function(a,u){o.ir=null,o.emit("message",JSON.stringify([a,u]))})}return i(r,e),r.transportName="iframe-info-receiver",r.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},Ye=r,Ye}var et,mn;function lr(){if(mn)return et;mn=1;var i=L().EventEmitter,e=T(),t=P(),n=On(),r=An();function s(o,a){var u=this;i.call(this);var l=function(){var c=u.ifr=new n(r.transportName,a,o);c.once("message",function(p){if(p){var v;try{v=JSON.parse(p)}catch{u.emit("finish"),u.close();return}var S=v[0],R=v[1];u.emit("finish",S,R)}u.close()}),c.once("close",function(){u.emit("finish"),u.close()})};b.document.body?l():t.attachEvent("load",l)}return e(s,i),s.enabled=function(){return n.enabled()},s.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},et=s,et}var tt,vn;function hr(){if(vn)return tt;vn=1;var i=L().EventEmitter,e=T(),t=B(),n=at(),r=oe(),s=J(),o=ur(),a=lr(),u=qn();function l(c,p){var v=this;i.call(this),setTimeout(function(){v.doXhr(c,p)},0)}return e(l,i),l._getReceiver=function(c,p,v){return v.sameOrigin?new u(p,s):r.enabled?new u(p,r):n.enabled&&v.sameScheme?new u(p,n):a.enabled()?new a(c,p):new u(p,o)},l.prototype.doXhr=function(c,p){var v=this,S=t.addPath(c,"/info");this.xo=l._getReceiver(c,S,p),this.timeoutRef=setTimeout(function(){v._cleanup(!1),v.emit("finish")},l.timeout),this.xo.once("finish",function(R,x){v._cleanup(!0),v.emit("finish",R,x)})},l.prototype._cleanup=function(c){clearTimeout(this.timeoutRef),this.timeoutRef=null,!c&&this.xo&&this.xo.close(),this.xo=null},l.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},l.timeout=8e3,tt=l,tt}var nt,gn;function dr(){if(gn)return nt;gn=1;var i=K();function e(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}return e.prototype._transportClose=function(t,n){i.postMessage("c",JSON.stringify([t,n]))},e.prototype._transportMessage=function(t){i.postMessage("t",t)},e.prototype._send=function(t){this._transport.send(t)},e.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},nt=e,nt}var rt,bn;function fr(){if(bn)return rt;bn=1;var i=B(),e=P(),t=dr(),n=An(),r=K(),s=Nn(),o=function(){};return rt=function(a,u){var l={};u.forEach(function(p){p.facadeTransport&&(l[p.facadeTransport.transportName]=p.facadeTransport)}),l[n.transportName]=n;var c;a.bootstrap_iframe=function(){var p;r.currentWindowId=s.hash.slice(1);var v=function(S){if(S.source===parent&&(typeof c>"u"&&(c=S.origin),S.origin===c)){var R;try{R=JSON.parse(S.data)}catch{o("bad json",S.data);return}if(R.windowId===r.currentWindowId)switch(R.type){case"s":var x;try{x=JSON.parse(R.data)}catch{o("bad json",R.data);break}var k=x[0],O=x[1],f=x[2],y=x[3];if(k!==a.version)throw new Error('Incompatible SockJS! Main site uses: "'+k+'", the iframe: "'+a.version+'".');if(!i.isOriginEqual(f,s.href)||!i.isOriginEqual(y,s.href))throw new Error("Can't connect to different domain from within an iframe. ("+s.href+", "+f+", "+y+")");p=new t(new l[O](f,y));break;case"m":p._send(R.data);break;case"c":p&&p._close(),p=null;break}}};e.attachEvent("message",v),r.postMessage("s")}},rt}var it,yn;function pr(){if(yn)return it;yn=1,rr();var i=Sn(),e=T(),t=$(),n=ir(),r=B(),s=P(),o=sr(),a=ct(),u=z(),l=or(),c=ut(),p=Cn(),v=Nn(),S=ar(),R=cr(),x=hr(),k=function(){},O;function f(h,m,E){if(!(this instanceof f))return new f(h,m,E);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");p.call(this),this.readyState=f.CONNECTING,this.extensions="",this.protocol="",E=E||{},E.protocols_whitelist&&l.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=E.transports,this._transportOptions=E.transportOptions||{},this._timeout=E.timeout||0;var g=E.sessionId||8;if(typeof g=="function")this._generateSessionId=g;else if(typeof g=="number")this._generateSessionId=function(){return t.string(g)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=E.server||t.numberString(1e3);var d=new i(h);if(!d.host||!d.protocol)throw new SyntaxError("The URL '"+h+"' is invalid");if(d.hash)throw new SyntaxError("The URL must not contain a fragment");if(d.protocol!=="http:"&&d.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+d.protocol+"' is not allowed.");var _=d.protocol==="https:";if(v.protocol==="https:"&&!_&&!r.isLoopbackAddr(d.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");m?Array.isArray(m)||(m=[m]):m=[];var C=m.sort();C.forEach(function(N,w){if(!N)throw new SyntaxError("The protocols entry '"+N+"' is invalid.");if(w<C.length-1&&N===C[w+1])throw new SyntaxError("The protocols entry '"+N+"' is duplicated.")});var I=r.getOrigin(v.href);this._origin=I?I.toLowerCase():null,d.set("pathname",d.pathname.replace(/\/+$/,"")),this.url=d.href,k("using url",this.url),this._urlInfo={nullOrigin:!u.hasDomain(),sameOrigin:r.isOriginEqual(this.url,v.href),sameScheme:r.isSchemeEqual(this.url,v.href)},this._ir=new x(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}e(f,p);function y(h){return h===1e3||h>=3e3&&h<=4999}return f.prototype.close=function(h,m){if(h&&!y(h))throw new Error("InvalidAccessError: Invalid code");if(m&&m.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===f.CLOSING||this.readyState===f.CLOSED)){var E=!0;this._close(h||1e3,m||"Normal closure",E)}},f.prototype.send=function(h){if(typeof h!="string"&&(h=""+h),this.readyState===f.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===f.OPEN&&this._transport.send(n.quote(h))},f.version=Rn(),f.CONNECTING=0,f.OPEN=1,f.CLOSING=2,f.CLOSED=3,f.prototype._receiveInfo=function(h,m){if(this._ir=null,!h){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(m),this._transUrl=h.base_url?h.base_url:this.url,h=a.extend(h,this._urlInfo);var E=O.filterToEnabled(this._transportsWhitelist,h);this._transports=E.main,k(this._transports.length+" enabled transports"),this._connect()},f.prototype._connect=function(){for(var h=this._transports.shift();h;h=this._transports.shift()){if(k("attempt",h.transportName),h.needBody&&(!b.document.body||typeof b.document.readyState<"u"&&b.document.readyState!=="complete"&&b.document.readyState!=="interactive")){this._transports.unshift(h),s.attachEvent("load",this._connect.bind(this));return}var m=Math.max(this._timeout,this._rto*h.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),m);var E=r.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),g=this._transportOptions[h.transportName],d=new h(E,this._transUrl,g);d.on("message",this._transportMessage.bind(this)),d.once("close",this._transportClose.bind(this)),d.transportName=h.transportName,this._transport=d;return}this._close(2e3,"All transports failed",!1)},f.prototype._transportTimeout=function(){this.readyState===f.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},f.prototype._transportMessage=function(h){var m=this,E=h.slice(0,1),g=h.slice(1),d;switch(E){case"o":this._open();return;case"h":this.dispatchEvent(new c("heartbeat")),k("heartbeat",this.transport);return}if(g)try{d=JSON.parse(g)}catch{}if(!(typeof d>"u"))switch(E){case"a":Array.isArray(d)&&d.forEach(function(_){k("message",m.transport),m.dispatchEvent(new R(_))});break;case"m":k("message",this.transport),this.dispatchEvent(new R(d));break;case"c":Array.isArray(d)&&d.length===2&&this._close(d[0],d[1],!0);break}},f.prototype._transportClose=function(h,m){if(k("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!y(h)&&h!==2e3&&this.readyState===f.CONNECTING){this._connect();return}this._close(h,m)},f.prototype._open=function(){k("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===f.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=f.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new c("open")),k("connected",this.transport)):this._close(1006,"Server lost session")},f.prototype._close=function(h,m,E){k("_close",this.transport,h,m,E,this.readyState);var g=!1;if(this._ir&&(g=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===f.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=f.CLOSING,setTimeout((function(){this.readyState=f.CLOSED,g&&this.dispatchEvent(new c("error"));var d=new S("close");d.wasClean=E||!1,d.code=h||1e3,d.reason=m,this.dispatchEvent(d),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},f.prototype.countRTO=function(h){return h>100?4*h:300+h},it=function(h){return O=o(h),fr()(f,h),f},it}var st,_n;function mr(){if(_n)return st;_n=1;var i=nr();return st=pr()(i),"_sockjs_onload"in b&&setTimeout(b._sockjs_onload,1),st}var vr=mr();const gr=Pn(vr);let D=null,lt=null;function br(){return"Invitado-"+Math.random().toString(36).slice(2,6).toUpperCase()}function wn(){document.getElementById("lead-form")?.remove();const i=document.getElementById("message");i&&(i.value=""),sessionStorage.removeItem("chat_welcome_shown")}function ot(){const i=document.getElementById("chat-messages");i&&(i.scrollTop=i.scrollHeight)}function Ln(i){const e=document.getElementById("chat-messages");if(!e)return;const t=document.createElement("div");t.className="message";const n=i.timestamp?new Date(i.timestamp).toLocaleTimeString():"";t.textContent=n?`[${n}] ${i.from||"Agente"}: ${i.content}`:`${i.from||"Agente"}: ${i.content}`,e.appendChild(t),ot()}function X(i,{key:e}={}){const t=document.getElementById("chat-messages");if(!t||e&&t.querySelector(`.message.system[data-key="${e}"]`))return;const n=document.createElement("div");n.className="message system",e&&(n.dataset.key=e),n.textContent=i,t.appendChild(n),t.scrollTop=t.scrollHeight}function yr(){sessionStorage.getItem("chat_welcome_shown")||(X("👋 ¡Hola! Contáctanos, estamos para ayudarte.",{key:"welcome"}),sessionStorage.setItem("chat_welcome_shown","1"))}function _r(){console.log("🔌 connectChat");const i=localStorage.getItem("jwt");lt=i?null:localStorage.getItem("chat_username")||null;const e=new gr(i?`/chat?token=${i}`:"/chat");D?.active||(D=new Dn({webSocketFactory:()=>e,reconnectDelay:5e3,onConnect:()=>{console.log("✅ Conectado al servidor WebSocket"),D.subscribe("/topic/messages",t=>{const n=JSON.parse(t.body);Ln(n)})},onStompError:t=>{console.error("STOMP error:",t.headers.message,t.body)},onWebSocketError:t=>{console.error("WebSocket error:",t)}}),window.stompClient=D,D.activate())}function En(){const i=document.getElementById("message"),e=i?.value.trim();if(!e||!D||!D.connected)return;const n=localStorage.getItem("jwt")?null:lt||localStorage.getItem("chat_username")||"Invitado",r={content:e,from:n,timestamp:new Date().toISOString()};D.publish({destination:"/app/send-message",body:JSON.stringify(r)}),Ln(r),i.value=""}function wr(){const i=document.getElementById("chat-messages");if(!i)return;const e=i.querySelector("#lead-form");if(e){e.querySelector("input, textarea")?.focus(),ot();return}const t=document.createElement("form");t.id="lead-form",t.className="message lead-form",t.innerHTML=`
    <div class="lead-form__title">Conoce nuestros servicios</div>

    <label class="lead-form__field">
      <span>Nombre</span>
      <input id="lead-name" type="text" name="name" required placeholder="Tu nombre">
    </label>

    <label class="lead-form__field">
      <span>Correo</span>
      <input id="lead-email" type="email" name="email" required placeholder="tucorreo@dominio.com">
    </label>

    <label class="lead-form__field">
      <span>Teléfono</span>
      <input id="lead-phone" type="tel" name="phone" required placeholder="+56 9 1234 5678">
    </label>

    <label class="lead-form__field">
      <span>Comentario</span>
      <textarea id="lead-message" name="message" rows="3" required placeholder="Cuéntanos qué necesitas"></textarea>
    </label>

    <div class="lead-form__actions">
      <button type="submit" class="btn-primary">Enviar solicitud</button>
      <button type="button" class="btn-ghost" id="lead-cancel">Cancelar</button>
    </div>
  `,i.appendChild(t),ot(),t.addEventListener("submit",async n=>{n.preventDefault();const r=document.getElementById("lead-name")?.value.trim()||"",s=document.getElementById("lead-email")?.value.trim()||"",o=document.getElementById("lead-phone")?.value.trim()||"",a=document.getElementById("lead-message")?.value.trim()||"",u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);if(!r||!u||!o||!a){X("Por favor completa todos los campos correctamente.");return}const l=t.querySelector(".btn-primary"),c=t.querySelector("#lead-cancel"),p=()=>{l&&(l.disabled=!1,l.textContent="Enviar solicitud"),c&&(c.disabled=!1)};l&&(l.disabled=!0,l.textContent="Enviando…"),c&&(c.disabled=!0);const v={name:r,email:s,phone:o,message:a,source:"chat",path:location.pathname+location.search+location.hash,title:document.title,tz:Intl.DateTimeFormat().resolvedOptions().timeZone},S=document.querySelector('meta[name="_csrf"]')?.content,R=document.querySelector('meta[name="_csrf_header"]')?.content,x={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};S&&R&&(x[R]=S);try{const k=await fetch("/public/api/contact",{method:"POST",headers:x,body:JSON.stringify(v),credentials:"same-origin"});if(!k.ok){const y=await k.text().catch(()=>"");throw new Error(`HTTP ${k.status}${y?`: ${y}`:""}`)}X("✅ ¡Gracias! Hemos recibido tu solicitud. Te contactaremos pronto.");const O=document.getElementById("chat-messages"),f=document.createElement("div");f.className="message me",f.textContent=`Solicitud enviada: ${r}, ${s}, ${o}. Mensaje: ${a}`,O.appendChild(f),window.dataLayer&&window.dataLayer.push({event:"lead_submit",lead_topic:"servicios",lead_email:s,lead_phone:o}),t.remove()}catch(k){console.error(k),X("❌ Ocurrió un problema al enviar. Intenta nuevamente.")}finally{p()}}),t.querySelector("#lead-cancel")?.addEventListener("click",()=>{t.remove(),X("Formulario cancelado.")}),t.querySelector('input[name="name"]')?.focus()}function Er(){if(console.log("🔌 Chat inicializado"),!document.getElementById("chat-widget")){console.warn("⚠️ chat-widget no encontrado. Chat no activado.");return}const e=document.getElementById("chat-button"),t=document.getElementById("chat-container"),n=document.getElementById("chat-close");e&&t&&e.addEventListener("click",()=>{const a=t.classList.contains("hidden");if(t.classList.toggle("hidden"),e.setAttribute("aria-expanded",String(a)),a){if(!localStorage.getItem("jwt")){let l=localStorage.getItem("chat_username");l||(l=br(),localStorage.setItem("chat_username",l)),lt=l}_r(),yr()}else wn()}),n?.addEventListener("click",()=>{wn(),t?.classList.add("hidden"),e?.setAttribute("aria-expanded","false")});const r=document.getElementById("send-btn");r&&r.addEventListener("click",En);const s=document.getElementById("message");s&&s.addEventListener("keyup",a=>{a.key==="Enter"&&En()});const o=document.getElementById("cta-services");o&&o.addEventListener("click",()=>{wr()})}export{Er as s};
