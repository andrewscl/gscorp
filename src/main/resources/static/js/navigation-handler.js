import{f as g}from"./auth.js";const y="modulepreload",p=function(e){return"/"+e},f={},h=function(r,t,i){let c=Promise.resolve();if(t&&t.length>0){let d=function(s){return Promise.all(s.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");c=d(t.map(s=>{if(s=p(s),s in f)return;f[s]=!0;const u=s.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${m}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":y,u||(l.as="script"),l.crossOrigin="",l.href=s,o&&l.setAttribute("nonce",o),document.head.appendChild(l),u)return new Promise((v,w)=>{l.addEventListener("load",v),l.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${s}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return c.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return r().catch(n)})},b=(e,r,t)=>{const i=e[r];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((c,n)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+r+(r.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};async function R(e,r=!1){const t=E(e),i=document.body.getAttribute("data-layout");if(e==="/public/home"){console.warn("[navigateTo] Redirigiendo a index-view para /public/home"),window.location.href="/public/home";return}if(!r&&t!==i){console.warn(`[navigateTo] Cambio de layout: 
                        ${i} -> ${t}`);const a=localStorage.getItem("jwt");if((t==="private"||t==="admin")&&a){sessionStorage.setItem("postLoginTarget",e),window.location.href=`/shell/${t}`;return}sessionStorage.setItem("postLoginTarget",e),window.location.href=`/shell/${t}`;return}try{const a=await L(e,t);if(!a)throw new Error("No content");const o=document.getElementById("content");if(!o)throw new Error("No se encontró el contenedor #content");document.dispatchEvent(new CustomEvent("fragment:will-unload",{detail:{path:e}})),o.innerHTML=a,await P(o,e),await k(e,o),window.history.pushState({},"",e),console.log(`[navigateTo] Ruta cargada dinámicamente: ${e}`),document.dispatchEvent(new CustomEvent("route:loaded",{detail:{path:e}}))}catch(a){console.error(`[navigateTo] Error: ${a.message}`),alert("Error al navegar a la ruta solicitada.")}}function E(e){return e==="/auth"||e.startsWith("/auth/")?"auth":e==="/private"||e.startsWith("/private/")||e==="/admin"||e.startsWith("/admin/")?"private":"public"}async function L(e,r){const t=localStorage.getItem("jwt"),i=e.includes("?")?"&":"?",c=`${e}${i}fragment=1`;return r==="private"&&t?g(c).then(n=>n.ok?n.text():null):fetch(c).then(n=>n.ok?n.text():null)}async function P(e,r){const t=e.querySelectorAll('script[type="module"]');for(const i of t)if(i.src){const c=new URL(i.src,location.origin);c.searchParams.set("v",Date.now());const n=await import(c.href);typeof n.init=="function"&&n.init({container:e,path:r})}else{const c=URL.createObjectURL(new Blob([i.textContent],{type:"text/javascript"})),n=await import(c);URL.revokeObjectURL(c),typeof n.init=="function"&&n.init({container:e,path:r})}}async function k(e,r){if(e==="/public/contact"){const{setupContact:t}=await b(Object.assign({"./contact.js":()=>h(()=>import("./contact.js"),[])}),`./contact.js?v=${Date.now()}`,2);typeof t=="function"&&await t({container:r,path:e})}}export{R as n};
