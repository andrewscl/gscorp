<section th:fragment="content" class="card forecast-creation">
  <h3>Crear Forecast</h3>

  <!-- Mensajes de estado -->
  <div id="forecast-status" aria-live="polite">Complete los campos para crear un forecast</div>

  <form id="forecast-form"
        data-forecast-endpoint="/api/forecasts"
        autocomplete="off">

    <!-- Compact layout: selects encadenados (client -> project -> site) -->
    <div class="row compact">
      <label for="forecast-client">Cliente
        <select id="forecast-client" name="clientId">
          <option value="">-- seleccionar --</option>
        </select>
      </label>

      <label for="forecast-project">Proyecto
        <select id="forecast-project" name="projectId" disabled>
          <option value="">-- seleccionar --</option>
        </select>
      </label>

      <label for="forecast-site">Sitio
        <select id="forecast-site" name="siteId" disabled>
          <option value="">-- (opcional) --</option>
        </select>
      </label>
    </div>

    <!-- Fila compacta de métrica / periodicidad / scope -->
    <div class="row compact">
      <label for="forecast-metric">Métrica
        <select id="forecast-metric" name="metric">
          <option value="VISITS">Visitas</option>
          <option value="ROUNDS">Rondas</option>
          <option value="ATTENDANCE">Asistencia</option>
        </select>
      </label>

      <label for="forecast-periodicity">Periodicidad
        <select id="forecast-periodicity" name="periodicity">
          <option value="DAILY">Diario</option>
          <option value="WEEKLY">Semanal</option>
          <option value="HOURLY">Horario</option>
        </select>
      </label>

      <!-- Scope visual (read-only inference preferred): site > project > client -->
      <div id="forecast-scope" class="scope-hint" aria-hidden="true">Scope: SITE / PROJECT / CLIENT</div>
    </div>

    <!-- Fechas y valor en una sola fila compacta -->
    <div class="row compact">
      <label for="forecast-start">Desde
        <input id="forecast-start" name="periodStart" type="date" />
      </label>

      <label for="forecast-end">Hasta
        <input id="forecast-end" name="periodEnd" type="date" />
      </label>

      <label for="forecast-value">Valor
        <input id="forecast-value" name="value" type="number" step="0.001" inputmode="decimal" />
      </label>
    </div>

    <!-- Units / Confidence / Version small inputs -->
    <div class="row compact">
      <label for="forecast-units">Units
        <input id="forecast-units" name="units" type="text" placeholder="e.g. count" />
      </label>

      <label for="forecast-confidence">Confianza (%)
        <input id="forecast-confidence" name="confidence" type="number" step="0.1" min="0" max="100" />
      </label>

      <input id="forecast-version" name="version" type="hidden" value="1" />
    </div>

    <!-- Nota breve -->
    <div class="form-group compact">
      <label for="forecast-note">Nota (opcional)
        <textarea id="forecast-note" name="note" rows="2" placeholder="Observación corta..."></textarea>
      </label>
    </div>

    <!-- Acciones compactas -->
    <div class="modal-footer compact">
      <button type="submit" class="btn btn-primary" id="forecast-save">Guardar</button>
      <button type="button" class="btn btn-secondary" id="forecast-cancel">Cancelar</button>
      <button type="button" class="btn btn-link" id="forecast-bulk" title="Crear forecasts en lote">Cargar CSV</button>
    </div>

  </form>

  <!-- Resumen compacto (preview) -->
  <div id="forecast-preview" aria-live="polite" class="compact-preview" hidden>
    <strong>Preview:</strong> <span id="forecast-preview-text"></span>
  </div>

  <!-- Script module para lógica: carga de selects, cascading, validación compacta y envío -->
  <script type="module" th:src="@{/js/private/forecast/create-forecast.js}" defer></script>
</section>