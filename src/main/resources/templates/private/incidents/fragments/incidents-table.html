<div th:fragment="content">
  <div class="incidents-header">
    <h2>
      <!-- Icono tabla (alerta/tabla) -->
      <svg width="24" height="24" viewBox="0 0 24 24" fill="#dc2626" style="vertical-align:-6px;margin-right:.5rem">
        <circle cx="12" cy="12" r="10" fill="#fee2e2"/>
        <path d="M12 8v4m0 4h.01" stroke="#991b1b" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Incidentes
    </h2>
    <button class="btn-primary" id="createIncidentBtn"
            data-path="/private/incidents/create">
      <!-- Icono añadir -->
      <svg width="20" height="20" fill="none" stroke="#fff" stroke-width="2" style="vertical-align:middle;margin-right:.25rem">
        <circle cx="10" cy="10" r="9" stroke="#fff" stroke-width="1.5" fill="#dc2626"/>
        <path d="M10 6v8M6 10h8" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Crear Incidente
    </button>
  </div>

  <div class="incident-table-container">
    <table class="incidents-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Sitio</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Apertura</th>
          <th>Primera resp.</th>
          <th>Cierre</th>
          <th>SLA (min)</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="inc : ${incidents}">
          <td th:text="${inc.id}"></td>

          <!-- siteName proveniente del DTO -->
          <td th:text="${inc.siteName != null ? inc.siteName : '—'}">—</td>

          <!-- incidentType (string) proveniente del DTO -->
          <td th:text="${inc.incidentType != null ? inc.incidentType : '—'}">—</td>

          <td>
            <span class="tag"
                  th:classappend="${inc.status == 'OPEN' ? 'open' : (inc.status == 'IN_PROGRESS' ? 'inprogress' : (inc.status == 'CLOSED' ? 'closed' : ''))}">
              <!-- Icono estado -->
              <span th:if="${inc.status == 'OPEN'}">
                <svg width="16" height="16" fill="none" style="vertical-align:middle;margin-right:.18rem">
                  <circle cx="8" cy="8" r="7" fill="#f59e42" stroke="#fde68a" stroke-width="2"/>
                  <path d="M8 5v3m0 3h.01" stroke="#92400e" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Abierto
              </span>
              <span th:if="${inc.status == 'IN_PROGRESS'}">
                <svg width="16" height="16" fill="none" style="vertical-align:middle;margin-right:.18rem">
                  <circle cx="8" cy="8" r="7" fill="#2563eb" stroke="#bfdbfe" stroke-width="2"/>
                  <path d="M6 8h4" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                </svg>
                En progreso
              </span>
              <span th:if="${inc.status == 'CLOSED'}">
                <svg width="16" height="16" fill="none" style="vertical-align:middle;margin-right:.18rem">
                  <circle cx="8" cy="8" r="7" fill="#64748b" stroke="#f1f5f9" stroke-width="2"/>
                  <path d="M5 8l6 0" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                  <circle cx="8" cy="8" r="2" fill="#6366f1"/>
                </svg>
                Cerrado
              </span>
              <span th:if="${inc.status != 'OPEN' && inc.status != 'IN_PROGRESS' && inc.status != 'CLOSED'}">—</span>
            </span>
          </td>

          <td th:text="${inc.openedTs != null ? #temporals.format(inc.openedTs, 'yyyy-MM-dd HH:mm') : '—'}">—</td>
          <td th:text="${inc.firstResponseTs != null ? #temporals.format(inc.firstResponseTs, 'yyyy-MM-dd HH:mm') : '—'}">—</td>
          <td th:text="${inc.closedTs != null ? #temporals.format(inc.closedTs, 'yyyy-MM-dd HH:mm') : '—'}">—</td>

          <!-- SLA con fallback -->
          <td th:text="${inc.slaMinutes != null ? inc.slaMinutes : '—'}">—</td>

          <td class="actions">
            <button type="button"
                    class="btn-link"
                    th:attr="data-path=@{/private/incidents/show/{id}(id=${inc.id})}">
              <!-- Icono ver -->
              <svg width="16" height="16" fill="none" style="vertical-align:middle;margin-right:.19rem">
                <ellipse cx="8" cy="8" rx="7" ry="6" fill="#bfdbfe" stroke="#1e3a8a" stroke-width="1"/>
                <circle cx="8" cy="8" r="2.2" fill="#1e3a8a"/>
              </svg>
              Ver
            </button>
            <button type="button"
                    class="btn-link"
                    th:attr="data-path=@{/private/incidents/edit/{id}(id=${inc.id})}"
                    th:if="${#authorization.expression('hasRole(''ADMINISTRATOR'')')}">
              <!-- Icono editar -->
              <svg width="16" height="16" fill="none" style="vertical-align:middle;margin-right:.19rem">
                <rect x="3" y="12" width="10" height="2" rx="0.7" fill="#fee2e2"/>
                <path d="M4 12l7-7a1 1 0 011.41 0l1.59 1.59a1 1 0 010 1.41l-7 7" stroke="#dc2626" stroke-width="1.2"/>
              </svg>
              Editar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>