<section th:fragment="content" class="detail-section view-shift-request">

  <h2>Ver Solicitud de Turno</h2>
  <p class="meta-id"><strong>ID:</strong> <span th:text="${shiftRequest.id}"></span></p>

  <form id="viewShiftRequestForm" class="card form">

    <!-- Sitio solo lectura -->
    <div class="form-group">
      <label>Sitio</label>
      <span class="readonly-field"
            th:text="${shiftRequest.site != null ? shiftRequest.site.name : '—'}"></span>
      <small>La solicitud de turno está asociada a un único sitio.</small>
    </div>

    <hr class="form-separator" />

    <div class="form-group">
      <label for="shiftRequestCode">Código</label>
      <input id="shiftRequestCode" name="code" type="text"
             th:value="${shiftRequest.code}" readonly tabindex="-1" />
    </div>

    <div class="form-group">
      <label for="shiftRequestType">Tipo</label>
      <!-- si tienes typeDisplay en el DTO, muéstralo en preferencia -->
      <input id="shiftRequestType" name="type" type="text"
             th:value="${shiftRequest.typeDisplay != null ? shiftRequest.typeDisplay : shiftRequest.type}" readonly tabindex="-1" />
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="shiftRequestStartDate">Fecha inicio</label>
        <input id="shiftRequestStartDate" name="startDate" type="date"
               th:value="${shiftRequest.startDate != null ? #temporals.format(shiftRequest.startDate,'yyyy-MM-dd') : ''}" readonly tabindex="-1" />
      </div>
      <div class="form-group">
        <label for="shiftRequestEndDate">Fecha término</label>
        <input id="shiftRequestEndDate" name="endDate" type="date"
               th:value="${shiftRequest.endDate != null ? #temporals.format(shiftRequest.endDate,'yyyy-MM-dd') : ''}" readonly tabindex="-1" />
      </div>
    </div>

    <!-- Schedules: mostramos un listado detallado (si existen) -->
    <div class="form-group" th:if="${shiftRequest.schedules != null && !#lists.isEmpty(shiftRequest.schedules)}">
      <label>Días / Tramos</label>
      <div class="schedules-list">
        <table class="table schedules-table">
          <thead>
            <tr>
              <th>Día(s)</th>
              <th>Inicio</th>
              <th>Término</th>
              <th>Colación</th>
              <th>Notas</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="s : ${shiftRequest.schedules}">
              <td th:text="${(s.dayFrom != null ? s.dayFrom : '') + (s.dayTo != null && s.dayTo != s.dayFrom ? ' - ' + s.dayTo : '')}">
                Lunes
              </td>

              <!-- startTime / endTime pueden ser LocalTime o String según DTO; si son LocalTime usamos #temporals.format -->
              <td th:text="${s.startTime != null ? (s.startTime.getClass().getName().startsWith('java.time') ? #temporals.format(s.startTime,'HH:mm') : s.startTime) : '—'}">
                08:30
              </td>

              <td th:text="${s.endTime != null ? (s.endTime.getClass().getName().startsWith('java.time') ? #temporals.format(s.endTime,'HH:mm') : s.endTime) : '—'}">
                20:30
              </td>

              <td th:text="${s.lunchTime != null ? (s.lunchTime.getClass().getName().startsWith('java.time') ? #temporals.format(s.lunchTime,'HH:mm') : s.lunchTime) : '—'}">
                13:30
              </td>

              <td th:text="${s.notes != null ? s.notes : ''}"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="form-group" th:if="${shiftRequest.schedules == null || #lists.isEmpty(shiftRequest.schedules)}">
      <label>Días / Tramos</label>
      <div class="readonly-field">—</div>
    </div>

    <div class="form-group">
      <label for="shiftRequestShiftDateTime">Fecha y Hora del Turno (SPORADIC)</label>
      <input id="shiftRequestShiftDateTime" name="shiftDateTime" type="datetime-local"
             th:value="${shiftRequest.shiftDateTime != null ? #temporals.format(shiftRequest.shiftDateTime,'yyyy-MM-dd''T''HH:mm') : ''}" readonly tabindex="-1" />
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="shiftRequestStartTime">Hora inicio</label>
        <input id="shiftRequestStartTime" name="startTime" type="time"
               th:value="${shiftRequest.startTime != null ? #temporals.format(shiftRequest.startTime,'HH:mm') : ''}" readonly tabindex="-1" />
      </div>
      <div class="form-group">
        <label for="shiftRequestEndTime">Hora término</label>
        <input id="shiftRequestEndTime" name="endTime" type="time"
               th:value="${shiftRequest.endTime != null ? #temporals.format(shiftRequest.endTime,'HH:mm') : ''}" readonly tabindex="-1" />
      </div>
      <div class="form-group">
        <label for="shiftRequestLunchTime">Hora de colación</label>
        <input id="shiftRequestLunchTime" name="lunchTime" type="time"
               th:value="${shiftRequest.lunchTime != null ? #temporals.format(shiftRequest.lunchTime,'HH:mm') : ''}" readonly tabindex="-1" />
      </div>
    </div>

    <div class="form-group">
      <label for="shiftRequestStatus">Estado</label>
      <input id="shiftRequestStatus" name="status" type="text"
             th:value="${shiftRequest.statusDisplay != null ? shiftRequest.statusDisplay : shiftRequest.status}" readonly tabindex="-1" />
    </div>

    <div class="form-group">
      <label for="shiftRequestDescription">Descripción</label>
      <textarea id="shiftRequestDescription" name="description" readonly tabindex="-1"
                th:text="${shiftRequest.description}" placeholder="Descripción"></textarea>
    </div>

    <div class="form-group">
      <label for="shiftRequestCreatedAt">Creado el</label>
      <input id="shiftRequestCreatedAt" name="createdAt" type="datetime-local"
             th:value="${shiftRequest.createdAt != null ? #temporals.format(shiftRequest.createdAt,'yyyy-MM-dd''T''HH:mm') : ''}" readonly tabindex="-1" />
    </div>

    <div class="actions">
      <a class="vs-btn vs-secondary" href="#" data-path="/private/shift-requests/table-view">Volver al listado</a>
    </div>

    <div id="viewShiftRequestError" class="form-error"></div>
    <div id="viewShiftRequestOk" class="form-ok" style="display:none;">Cambios guardados ✅</div>
  </form>

</section>