<section th:fragment="content" class="editUser">

  <div class="editUserCard">

    <div class="editUserHeader">
      <h3>Editar usuario</h3>
    </div>

    <div class="editUser-photo-and-info">

      <!-- Información básica del usuario -->
      <div class="editUser-body">
        <div class="form-group">
          <label for="userId">ID</label>
          <input type="text" id="userId" name="id" th:value="${user.id}" readonly />
        </div>
        <div class="form-group">
          <label for="userUsername">Username</label>
          <input type="text" id="userUsername" name="username" th:value="${user.username}" required />
        </div>
        <div class="form-group">
          <label for="userMail">Mail</label>
          <input type="email" id="userMail" name="mail" th:value="${user.mail}" required />
        </div>
        <div class="form-group">
          <label for="userActive">Activo</label>
          <input type="checkbox" id="userActive" name="active" th:checked="${user.active}" />
        </div>
      </div>

    </div>

    <form id="editUserForm" class="editUser-body">

      <!-- Roles -->
      <div class="form-group">
        <label for="userRoles">Roles</label>
        <select id="userRoles" name="roleIds" multiple size="6">
          <option th:each="r : ${rolesAvailable}"
                  th:value="${r.id}"
                  th:text="${r.name != null ? r.name : r.role}"
                  th:selected="${user.roles != null and user.roles.contains(r)}"></option>
        </select>
      </div>

      <!-- Clientes -->
      <div class="form-group">
        <label for="userClients">Clientes</label>
        <select id="userClients" name="clientIds" multiple size="6">
          <option th:each="c : ${clientsAvailable}"
                  th:value="${c.id}"
                  th:text="${c.name}"
                  th:selected="${user.clients != null and user.clients.contains(c)}"></option>
        </select>
      </div>

      <!-- Empleado asociado -->
      <div class="form-group">
        <label for="userEmployeeId">Empleado asociado</label>
        <select id="userEmployeeId" name="employeeId">
          <option value="">-- ninguno --</option>
          <option th:each="e : ${employeesAvailable}"
                  th:value="${e.id}"
                  th:text="${e.fullName != null ? e.fullName : e.id}"
                  th:selected="${user.employee != null and user.employee.id == e.id}"></option>
        </select>
      </div>

      <!-- Zona horaria -->
      <div class="form-group">
        <label for="userTimeZone">Zona horaria (IANA)</label>
        <input type="text" id="userTimeZone" name="timeZone" th:value="${user.timeZone}" placeholder="Europe/Madrid" />
        <button type="button" id="detectUserTimeZone" class="vs-btn vs-secondary">Detectar zona</button>
      </div>

      <!-- Elementos de control -->
      <div class="modal-footer">
        <button type="submit" class="btn-primary">Guardar cambios</button>

        <a class="btn-secondary" href="#"
                    data-path="/private/users/table-view">Volver al listado</a>

        <button type="button" id="deleteUserBtn" class="btn-danger"
                th:attr="data-id=${user.id}">Eliminar usuario</button>
      </div>

      <div class="form-error" id="editUserError"></div>
      <div class="form-ok" id="editUserOk" style="display:none;">Usuario actualizado ✅</div>

    </form>

  </div>

  <script type="module" src="/js/private/users/edit-user.js"></script>

</section>