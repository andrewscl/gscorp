<div th:fragment="content">

  <!-- Header + botón crear -->
  <div class="sites-header">
    <h2>Sitios</h2>
    <button class="btn-primary" id="createSiteBtn">Crear Sitio</button>
  </div>

  <!-- Tabla de sitios -->
  <div class="site-table-container">
    <table class="sites-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Código</th>
          <th>Dirección</th>
          <th>Cliente</th>
          <th>Zona horaria</th>
          <th>Estado</th>
          <th>acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="s : ${sites}">
          <td th:text="${s.id}"></td>
          <td th:text="${s.name}"></td>
          <td th:text="${s.code}">—</td>
          <td th:text="${s.address}">—</td>
          <td th:text="${s.client != null ? s.client.name : '—'}">—</td>
          <td th:text="${s.timeZone}">—</td>

          <!-- Tag de estado -->
          <td>
            <span class="tag"
                  th:text="${s.active} ? 'Activo' : 'Inactivo'">Activo</span>
          </td>

          <td class="actions">
            <button type="button"
                    class="btn-link"
                    th:attr="data-path=@{/private/sites/show/{id}(id=${s.id})}">
              Ver
            </button>

            <button type="button"
                    class="btn-link"
                    th:attr="data-path=@{/private/sites/edit/{id}(id=${s.id})}">
              Editar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Crear Sitio -->
  <div id="createSiteModal" class="modal hidden" aria-hidden="true" role="dialog">
    <div class="modal-dialog">
      <div class="modal-header">
        <h3>Crear sitio</h3>
        <button type="button" class="modal-close" id="closeCreateSite">&times;</button>
      </div>

      <form id="createSiteForm" class="modal-body">
        <!-- Cliente -->
        <div class="form-group">
          <label for="siteClientId">Cliente</label>
          <select id="siteClientId" name="clientId" required>
            <option value="" disabled selected>Selecciona un cliente…</option>
            <!-- Asume que el controlador inyecta model.addAttribute("clients", listaDeClientes) -->
            <option th:each="c : ${clients}" th:value="${c.id}" th:text="${c.name}"></option>
          </select>
          <small>Si no ves el cliente, créalo primero en <strong>Gestión &rarr; Clientes</strong>.</small>
        </div>

        <!-- Nombre / Código -->
        <div class="form-group">
          <label for="siteName">Nombre</label>
          <input type="text" id="siteName" name="name" placeholder="Nombre de sitio" required />
        </div>

        <div class="form-group">
          <label for="siteCode">Código</label>
          <input type="text" id="siteCode" name="code" placeholder="Código interno/externo" />
        </div>

        <!-- Dirección -->
        <div class="form-group">
          <label for="siteAddress">Dirección</label>
          <input type="text" id="siteAddress" name="address" placeholder="Dirección" />
        </div>

        <!-- Geo -->
        <div class="form-group">
          <label for="siteLat">Latitud</label>
          <input type="number" step="any" id="siteLat" name="lat" placeholder="-33.45" />
        </div>

        <div class="form-group">
          <label for="siteLon">Longitud</label>
          <input type="number" step="any" id="siteLon" name="lon" placeholder="-70.666" />
        </div>

        <!-- Zona Horaria -->
        <div class="form-group">
          <label for="siteTz">Zona horaria</label>
          <input type="text" id="siteTz" name="timeZone" placeholder="America/Santiago" />
          <small>Formato IANA (ej: America/Santiago, America/Bogota).</small>
        </div>

        <!-- Activo -->
        <div class="form-group" style="display:flex;align-items:center;gap:.5rem">
          <input type="checkbox" id="siteActive" name="active" checked />
          <label for="siteActive" style="margin:0">Activo</label>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn-primary">Crear</button>
          <button type="button" class="btn-secondary" id="cancelCreateSite">Cancelar</button>
        </div>

        <div class="form-error" id="createSiteError"></div>
        <div class="form-ok" id="createSiteOk" style="display:none;">Sitio creado ✅</div>
      </form>
    </div>
  </div>

  <!-- JS del modal de creación -->
  <script type="module" src="/js/private/sites/create-site.js"></script>
</div>
